//This file has been generated by AdvancedSkeletonSelector//
//Using AdvancedSkeleton Version: 5.365//

global proc asSelectorface ()
{
if (`window -q -ex asSelectorface`)
	deleteUI asSelectorface;

string $asSelectorScriptLocation=`asSelectorScriptLocation`;
string $asIconLocation=$asSelectorScriptLocation+"face/";
window -rtf 1 -mb 1 -t face asSelectorface;
menu -l Edit;
	menuItem -l Refresh -c "asPopulateNameSpaceMenu asSelectorface";
	menuItem -l Filter -c "asFilterNameSpaceMenuUI asSelectorface";
	setParent..;
menu -l Display;
	menuItem -l Controls -c asControlsVisibilityToggle;
	menuItem -l "Set HotKey" -c asSetupControlVisibilityHotKeyDialog;
	menuItem -l Joints -c "asJointsVisibilityToggle asSelectorface";
	menuItem -d 1;
	menuItem -l GimbalLock -c "asVisualizeGimbalLock asSelectorface";
	setParent..;
menu -l Pose -aob 1;
	menuItem -l Copy -c "asCopyToClipBoard asSelectorface 0";
	menuItem -l Paste -en 0 asSelectorfacePosePaste;
	menuItem -d 1;
	menuItem -l Reset -c "asGoToBuildPose asSelectorface";
	menuItem -l Mirror -c "asMirror asSelectorface";
	menuItem -optionBox 1 -c "asMirrorOptions asSelectorface";
	setParent..;
menu -l Anim;
	menuItem -l Copy -c "asCopyToClipBoard asSelectorface 1";
	menuItem -l Paste -en 0 asSelectorfaceAnimPaste;
	menuItem -d 1;
	menuItem -l Clean -c "asDeleteStaticChannels asSelectorface";
	menuItem -d 1;
	menuItem -l Bake -c "asAnimBake asSelectorface";
	menuItem -d 1;
	menuItem -l SwitchFKIK -c asAutoSwitchFKIK;
	menuItem -l SwitchPivot -c asAutoSwitchPivot;
menu -l Dynamics;
	menuItem -l "Add to selected" -c "asDynAdd asSelectorface";
	menuItem -l "Remove from selected" -c "asDynRemove asSelectorface";
	menuItem -d 1;
	menuItem -l "Set Initial State" -c "evalEcho saveInitialState -all";
	menuItem -l "Interactive Playback" -c "evalEcho InteractivePlayback";
	menuItem -d 1;
	menuItem -l Bake -c "asDynBake asSelectorface";
	menuItem -l UnBake -c "asDynUnBake asSelectorface";
menu -l Parent;
	menuItem -l "Add parent constraint" -c "asParentAdd asPicker 0";
	menuItem -l "Add parent constraint (Extra)" -c "asParentAdd asPicker 1";

columnLayout -adj 1;
text -m 0 -l "FaceControlSet " asSelectorfaceControlSetsText;
rowLayout -nc 5 -adj 1 -cat 1 right 0 -cw 2 30 -cw 3 65 -cw 4 50 -cw 5 60;
optionMenu -cc asSelChange asSelectorfaceOptionMenu;
button -l set -c "asSetNameSpaceFromSelection asSelectorface";
checkBox -v `optionVar -q asShowSelection` -onc "optionVar -iv asShowSelection 1;asSelChangeToggle;" -ofc "optionVar -iv asShowSelection 0;asSelChangeToggle;" -l Selection asSelectorfaceSelectionCheckBox;
checkBox -v `optionVar -q asShowKeyed` -onc "optionVar -iv asShowKeyed 1;asSelChangeToggle;" -ofc "optionVar -iv asShowKeyed 0;asSelChangeToggle;" -l Keyed asSelectorfaceKeyedCheckBox;
checkBox -v `optionVar -q asShowExtra` -onc "optionVar -iv asShowExtra 1;asSelChangeToggle;" -ofc "optionVar -iv asShowExtra 0;asSelChangeToggle;" -l Extra asSelectorfaceExtraCheckBox;
setParent..;
formLayout asSelectorfaceFormLayout;

//Controls Begin//
image -en 0 -w 400 -h 240 -i ($asIconLocation+"face_background.png") "asSelectorfaceBGPicture";
iconTextButton -w 46 -h 11 -i ($asIconLocation+"face_squashTop_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"squashTop_M\"};" -ann "squashTop_M" "squashTop_M:27:29";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"squashTop_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"squashTop_M\"};";
iconTextButton -w 46 -h 11 -i ($asIconLocation+"face_squashMiddle_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"squashMiddle_M\"};" -ann "squashMiddle_M" "squashMiddle_M:27:42";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"squashMiddle_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"squashMiddle_M\"};";
iconTextButton -w 46 -h 11 -i ($asIconLocation+"face_squashBase_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"squashBase_M\"};" -ann "squashBase_M" "squashBase_M:27:55";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"squashBase_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"squashBase_M\"};";
iconTextButton -w 22 -h 15 -i ($asIconLocation+"face_EyeBrowRegion_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowRegion_R\"};" -ann "EyeBrowRegion_R" "EyeBrowRegion_R:75:58";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowRegion_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowRegion_R\"};";
iconTextButton -w 26 -h 26 -i ($asIconLocation+"face_EyeRegion_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeRegion_R\"};" -ann "EyeRegion_R" "EyeRegion_R:73:80";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeRegion_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeRegion_R\"};";
iconTextButton -w 28 -h 51 -i ($asIconLocation+"face_AimEye_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"AimEye_M\"};" -ann "AimEye_M" "AimEye_M:38:100";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"AimEye_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"AimEye_M\"};";
iconTextButton -w 15 -h 10 -i ($asIconLocation+"face_AimEye_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"AimEye_R\"};" -ann "AimEye_R" "AimEye_R:22:110";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"AimEye_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"AimEye_R\"};";
iconTextButton -w 15 -h 10 -i ($asIconLocation+"face_AimEye_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"AimEye_L\"};" -ann "AimEye_L" "AimEye_L:67:110";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"AimEye_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"AimEye_L\"};";
iconTextButton -w 30 -h 14 -i ($asIconLocation+"face_upperFace_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperFace_M\"};" -ann "upperFace_M" "upperFace_M:86:118";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperFace_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperFace_M\"};";
iconTextButton -w 30 -h 14 -i ($asIconLocation+"face_middleFace_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"middleFace_M\"};" -ann "middleFace_M" "middleFace_M:92:137";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"middleFace_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"middleFace_M\"};";
iconTextButton -w 36 -h 14 -i ($asIconLocation+"face_lowerFace_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerFace_M\"};" -ann "lowerFace_M" "lowerFace_M:93:155";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerFace_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerFace_M\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_upperLipRegion_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLipRegion_M\"};" -ann "upperLipRegion_M" "upperLipRegion_M:81:172";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLipRegion_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLipRegion_M\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_LipRegion_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"LipRegion_M\"};" -ann "LipRegion_M" "LipRegion_M:81:181";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"LipRegion_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"LipRegion_M\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_lowerLipRegion_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLipRegion_M\"};" -ann "lowerLipRegion_M" "lowerLipRegion_M:81:190";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLipRegion_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLipRegion_M\"};";
iconTextButton -w 42 -h 24 -i ($asIconLocation+"face_FaceControlSet_OffK0.png") -iol "" -c "asSelect \"face\" {\"FaceControlSet\"};" -ann "FaceControlSet" "FaceControlSet:49:4";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"FaceControlSet\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"FaceControlSet\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_Tongue0_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"Tongue0_M\"};" -ann "Tongue0_M" "Tongue0_M:27:163";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Tongue0_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Tongue0_M\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_Tongue1_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"Tongue1_M\"};" -ann "Tongue1_M" "Tongue1_M:27:179";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Tongue1_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Tongue1_M\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_Tongue2_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"Tongue2_M\"};" -ann "Tongue2_M" "Tongue2_M:27:194";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Tongue2_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Tongue2_M\"};";
iconTextButton -w 48 -h 9 -i ($asIconLocation+"face_Tongue3_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"Tongue3_M\"};" -ann "Tongue3_M" "Tongue3_M:27:209";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Tongue3_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Tongue3_M\"};";
iconTextButton -w 98 -h 14 -i ($asIconLocation+"face_Jaw_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"Jaw_M\"};" -ann "Jaw_M" "Jaw_M:151:224";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Jaw_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Jaw_M\"};";
iconTextButton -w 43 -h 10 -i ($asIconLocation+"face_upperTeeth_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperTeeth_M\"};" -ann "upperTeeth_M" "upperTeeth_M:267:174";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperTeeth_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperTeeth_M\"};";
iconTextButton -w 43 -h 10 -i ($asIconLocation+"face_lowerTeeth_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerTeeth_M\"};" -ann "lowerTeeth_M" "lowerTeeth_M:267:188";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerTeeth_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerTeeth_M\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlBrow_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlBrow_R\"};" -ann "ctrlBrow_R" "ctrlBrow_R:333:37";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlBrow_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlBrow_R\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlBrow_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlBrow_L\"};" -ann "ctrlBrow_L" "ctrlBrow_L:367:37";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlBrow_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlBrow_L\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlEye_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlEye_R\"};" -ann "ctrlEye_R" "ctrlEye_R:333:65";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlEye_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlEye_R\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlEye_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlEye_L\"};" -ann "ctrlEye_L" "ctrlEye_L:367:65";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlEye_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlEye_L\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlCheek_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlCheek_R\"};" -ann "ctrlCheek_R" "ctrlCheek_R:333:94";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlCheek_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlCheek_R\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlCheek_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlCheek_L\"};" -ann "ctrlCheek_L" "ctrlCheek_L:367:94";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlCheek_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlCheek_L\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlNose_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlNose_R\"};" -ann "ctrlNose_R" "ctrlNose_R:333:122";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlNose_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlNose_R\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlNose_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlNose_L\"};" -ann "ctrlNose_L" "ctrlNose_L:367:122";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlNose_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlNose_L\"};";
iconTextButton -w 34 -h 33 -i ($asIconLocation+"face_ctrlMouth_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlMouth_M\"};" -ann "ctrlMouth_M" "ctrlMouth_M:346:151";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlMouth_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlMouth_M\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlMouthCorner_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlMouthCorner_R\"};" -ann "ctrlMouthCorner_R" "ctrlMouthCorner_R:333:188";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlMouthCorner_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlMouthCorner_R\"};";
iconTextButton -w 26 -h 24 -i ($asIconLocation+"face_ctrlMouthCorner_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlMouthCorner_L\"};" -ann "ctrlMouthCorner_L" "ctrlMouthCorner_L:367:188";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlMouthCorner_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlMouthCorner_L\"};";
iconTextButton -w 79 -h 11 -i ($asIconLocation+"face_ctrlBox_OffK0.png") -iol "" -c "asSelect \"face\" {\"ctrlBox\"};" -ann "ctrlBox" "ctrlBox:320:216";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"ctrlBox\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"ctrlBox\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_EyeBrowInner_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowInner_R\"};" -ann "EyeBrowInner_R" "EyeBrowInner_R:175:51";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowInner_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowInner_R\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowMid1_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMid1_R\"};" -ann "EyeBrowMid1_R" "EyeBrowMid1_R:160:49";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMid1_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMid1_R\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowMid2_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMid2_R\"};" -ann "EyeBrowMid2_R" "EyeBrowMid2_R:148:50";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMid2_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMid2_R\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowMid3_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMid3_R\"};" -ann "EyeBrowMid3_R" "EyeBrowMid3_R:136:53";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMid3_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMid3_R\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowOuter_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowOuter_R\"};" -ann "EyeBrowOuter_R" "EyeBrowOuter_R:127:60";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowOuter_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowOuter_R\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_upperLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLid_R\"};" -ann "upperLid_R" "upperLid_R:154:69";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLid_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperOuterLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperOuterLid_R\"};" -ann "upperOuterLid_R" "upperOuterLid_R:141:76";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperOuterLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperOuterLid_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerOuterLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerOuterLid_R\"};" -ann "lowerOuterLid_R" "lowerOuterLid_R:143:98";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerOuterLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerOuterLid_R\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_lowerLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLid_R\"};" -ann "lowerLid_R" "lowerLid_R:154:99";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLid_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerInnerLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerInnerLid_R\"};" -ann "lowerInnerLid_R" "lowerInnerLid_R:172:98";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerInnerLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerInnerLid_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperInnerLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperInnerLid_R\"};" -ann "upperInnerLid_R" "upperInnerLid_R:173:76";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperInnerLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperInnerLid_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_outerLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"outerLid_R\"};" -ann "outerLid_R" "outerLid_R:136:89";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"outerLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"outerLid_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_innerLid_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"innerLid_R\"};" -ann "innerLid_R" "innerLid_R:180:89";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"innerLid_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"innerLid_R\"};";
iconTextButton -w 20 -h 7 -i ($asIconLocation+"face_upperSmileFold_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperSmileFold_R\"};" -ann "upperSmileFold_R" "upperSmileFold_R:151:122";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperSmileFold_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperSmileFold_R\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_Cheek_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"Cheek_R\"};" -ann "Cheek_R" "Cheek_R:132:138";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Cheek_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Cheek_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_NoseCorner_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"NoseCorner_R\"};" -ann "NoseCorner_R" "NoseCorner_R:174:134";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"NoseCorner_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"NoseCorner_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_Nostril_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"Nostril_R\"};" -ann "Nostril_R" "Nostril_R:185:128";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Nostril_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Nostril_R\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_Nose_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"Nose_M\"};" -ann "Nose_M" "Nose_M:194:133";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Nose_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Nose_M\"};";
iconTextButton -w 12 -h 10 -i ($asIconLocation+"face_NoseUnder_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"NoseUnder_M\"};" -ann "NoseUnder_M" "NoseUnder_M:194:147";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"NoseUnder_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"NoseUnder_M\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_NoseSide_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"NoseSide_R\"};" -ann "NoseSide_R" "NoseSide_R:177:117";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"NoseSide_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"NoseSide_R\"};";
iconTextButton -w 12 -h 10 -i ($asIconLocation+"face_NoseMiddle_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"NoseMiddle_M\"};" -ann "NoseMiddle_M" "NoseMiddle_M:194:108";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"NoseMiddle_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"NoseMiddle_M\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_upperLip_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLip_M\"};" -ann "upperLip_M" "upperLip_M:194:166";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLip_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLip_M\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_lowerLip_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLip_M\"};" -ann "lowerLip_M" "lowerLip_M:194:182";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLip_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLip_M\"};";
iconTextButton -w 9 -h 18 -i ($asIconLocation+"face_Lip_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"Lip_R\"};" -ann "Lip_R" "Lip_R:163:165";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Lip_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Lip_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperLipA_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLipA_R\"};" -ann "upperLipA_R" "upperLipA_R:184:165";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLipA_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLipA_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperLipB_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLipB_R\"};" -ann "upperLipB_R" "upperLipB_R:173:165";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLipB_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLipB_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerLipA_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLipA_R\"};" -ann "lowerLipA_R" "lowerLipA_R:182:182";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLipA_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLipA_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerLipB_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLipB_R\"};" -ann "lowerLipB_R" "lowerLipB_R:172:178";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLipB_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLipB_R\"};";
iconTextButton -w 12 -h 10 -i ($asIconLocation+"face_EyeBrowMiddle_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMiddle_M\"};" -ann "EyeBrowMiddle_M" "EyeBrowMiddle_M:194:56";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMiddle_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMiddle_M\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_Crease_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"Crease_R\"};" -ann "Crease_R" "Crease_R:152:163";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Crease_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Crease_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperCreaseB_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperCreaseB_R\"};" -ann "upperCreaseB_R" "upperCreaseB_R:157:152";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperCreaseB_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperCreaseB_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperCreaseA_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperCreaseA_R\"};" -ann "upperCreaseA_R" "upperCreaseA_R:168:147";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperCreaseA_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperCreaseA_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerCreaseB_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerCreaseB_R\"};" -ann "lowerCreaseB_R" "lowerCreaseB_R:161:186";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerCreaseB_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerCreaseB_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerCreaseA_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerCreaseA_R\"};" -ann "lowerCreaseA_R" "lowerCreaseA_R:176:193";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerCreaseA_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerCreaseA_R\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerCrease_M_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerCrease_M\"};" -ann "lowerCrease_M" "lowerCrease_M:195:200";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerCrease_M\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerCrease_M\"};";
iconTextButton -w 8 -h 20 -i ($asIconLocation+"face_SmileFold_R_OffK0.png") -iol "" -c "asSelect \"face\" {\"SmileFold_R\"};" -ann "SmileFold_R" "SmileFold_R:144:157";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"SmileFold_R\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"SmileFold_R\"};";
iconTextButton -w 22 -h 15 -i ($asIconLocation+"face_EyeBrowRegion_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowRegion_L\"};" -ann "EyeBrowRegion_L" "EyeBrowRegion_L:303:58";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowRegion_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowRegion_L\"};";
iconTextButton -w 26 -h 26 -i ($asIconLocation+"face_EyeRegion_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeRegion_L\"};" -ann "EyeRegion_L" "EyeRegion_L:301:80";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeRegion_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeRegion_L\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_EyeBrowInner_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowInner_L\"};" -ann "EyeBrowInner_L" "EyeBrowInner_L:210:51";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowInner_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowInner_L\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowMid1_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMid1_L\"};" -ann "EyeBrowMid1_L" "EyeBrowMid1_L:228:49";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMid1_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMid1_L\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowMid2_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMid2_L\"};" -ann "EyeBrowMid2_L" "EyeBrowMid2_L:240:50";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMid2_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMid2_L\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowMid3_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowMid3_L\"};" -ann "EyeBrowMid3_L" "EyeBrowMid3_L:252:53";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowMid3_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowMid3_L\"};";
iconTextButton -w 12 -h 12 -i ($asIconLocation+"face_EyeBrowOuter_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"EyeBrowOuter_L\"};" -ann "EyeBrowOuter_L" "EyeBrowOuter_L:261:60";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"EyeBrowOuter_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"EyeBrowOuter_L\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_upperLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLid_L\"};" -ann "upperLid_L" "upperLid_L:231:69";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLid_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperOuterLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperOuterLid_L\"};" -ann "upperOuterLid_L" "upperOuterLid_L:250:76";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperOuterLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperOuterLid_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerOuterLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerOuterLid_L\"};" -ann "lowerOuterLid_L" "lowerOuterLid_L:248:98";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerOuterLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerOuterLid_L\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_lowerLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLid_L\"};" -ann "lowerLid_L" "lowerLid_L:231:99";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLid_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerInnerLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerInnerLid_L\"};" -ann "lowerInnerLid_L" "lowerInnerLid_L:219:98";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerInnerLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerInnerLid_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperInnerLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperInnerLid_L\"};" -ann "upperInnerLid_L" "upperInnerLid_L:218:76";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperInnerLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperInnerLid_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_outerLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"outerLid_L\"};" -ann "outerLid_L" "outerLid_L:255:89";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"outerLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"outerLid_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_innerLid_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"innerLid_L\"};" -ann "innerLid_L" "innerLid_L:211:89";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"innerLid_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"innerLid_L\"};";
iconTextButton -w 20 -h 7 -i ($asIconLocation+"face_upperSmileFold_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperSmileFold_L\"};" -ann "upperSmileFold_L" "upperSmileFold_L:229:122";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperSmileFold_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperSmileFold_L\"};";
iconTextButton -w 15 -h 15 -i ($asIconLocation+"face_Cheek_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"Cheek_L\"};" -ann "Cheek_L" "Cheek_L:253:138";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Cheek_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Cheek_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_NoseCorner_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"NoseCorner_L\"};" -ann "NoseCorner_L" "NoseCorner_L:217:134";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"NoseCorner_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"NoseCorner_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_Nostril_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"Nostril_L\"};" -ann "Nostril_L" "Nostril_L:206:128";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Nostril_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Nostril_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_NoseSide_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"NoseSide_L\"};" -ann "NoseSide_L" "NoseSide_L:214:117";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"NoseSide_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"NoseSide_L\"};";
iconTextButton -w 9 -h 18 -i ($asIconLocation+"face_Lip_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"Lip_L\"};" -ann "Lip_L" "Lip_L:228:165";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Lip_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Lip_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperLipA_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLipA_L\"};" -ann "upperLipA_L" "upperLipA_L:207:165";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLipA_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLipA_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperLipB_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperLipB_L\"};" -ann "upperLipB_L" "upperLipB_L:218:165";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperLipB_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperLipB_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerLipA_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLipA_L\"};" -ann "lowerLipA_L" "lowerLipA_L:209:182";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLipA_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLipA_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerLipB_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerLipB_L\"};" -ann "lowerLipB_L" "lowerLipB_L:219:178";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerLipB_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerLipB_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_Crease_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"Crease_L\"};" -ann "Crease_L" "Crease_L:239:163";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"Crease_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"Crease_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperCreaseB_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperCreaseB_L\"};" -ann "upperCreaseB_L" "upperCreaseB_L:234:152";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperCreaseB_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperCreaseB_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_upperCreaseA_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"upperCreaseA_L\"};" -ann "upperCreaseA_L" "upperCreaseA_L:223:147";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"upperCreaseA_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"upperCreaseA_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerCreaseB_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerCreaseB_L\"};" -ann "lowerCreaseB_L" "lowerCreaseB_L:230:186";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerCreaseB_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerCreaseB_L\"};";
iconTextButton -w 9 -h 9 -i ($asIconLocation+"face_lowerCreaseA_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"lowerCreaseA_L\"};" -ann "lowerCreaseA_L" "lowerCreaseA_L:215:193";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"lowerCreaseA_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"lowerCreaseA_L\"};";
iconTextButton -w 8 -h 20 -i ($asIconLocation+"face_SmileFold_L_OffK0.png") -iol "" -c "asSelect \"face\" {\"SmileFold_L\"};" -ann "SmileFold_L" "SmileFold_L:248:157";
popupMenu;
	menuItem -l Key -c "asKey \"face\" {\"SmileFold_L\"};";
	menuItem -l LinearKey -c "asLinearKey \"face\" {\"SmileFold_L\"};";
//Controls End//

formLayout -e
	-af "squashTop_M:27:29" left 27
	-af "squashTop_M:27:29" top 29
	-af "squashMiddle_M:27:42" left 27
	-af "squashMiddle_M:27:42" top 42
	-af "squashBase_M:27:55" left 27
	-af "squashBase_M:27:55" top 55
	-af "EyeBrowRegion_R:75:58" left 75
	-af "EyeBrowRegion_R:75:58" top 58
	-af "EyeRegion_R:73:80" left 73
	-af "EyeRegion_R:73:80" top 80
	-af "AimEye_M:38:100" left 38
	-af "AimEye_M:38:100" top 100
	-af "AimEye_R:22:110" left 22
	-af "AimEye_R:22:110" top 110
	-af "AimEye_L:67:110" left 67
	-af "AimEye_L:67:110" top 110
	-af "upperFace_M:86:118" left 86
	-af "upperFace_M:86:118" top 118
	-af "middleFace_M:92:137" left 92
	-af "middleFace_M:92:137" top 137
	-af "lowerFace_M:93:155" left 93
	-af "lowerFace_M:93:155" top 155
	-af "upperLipRegion_M:81:172" left 81
	-af "upperLipRegion_M:81:172" top 172
	-af "LipRegion_M:81:181" left 81
	-af "LipRegion_M:81:181" top 181
	-af "lowerLipRegion_M:81:190" left 81
	-af "lowerLipRegion_M:81:190" top 190
	-af "FaceControlSet:49:4" left 49
	-af "FaceControlSet:49:4" top 4
	-af "Tongue0_M:27:163" left 27
	-af "Tongue0_M:27:163" top 163
	-af "Tongue1_M:27:179" left 27
	-af "Tongue1_M:27:179" top 179
	-af "Tongue2_M:27:194" left 27
	-af "Tongue2_M:27:194" top 194
	-af "Tongue3_M:27:209" left 27
	-af "Tongue3_M:27:209" top 209
	-af "Jaw_M:151:224" left 151
	-af "Jaw_M:151:224" top 224
	-af "upperTeeth_M:267:174" left 267
	-af "upperTeeth_M:267:174" top 174
	-af "lowerTeeth_M:267:188" left 267
	-af "lowerTeeth_M:267:188" top 188
	-af "ctrlBrow_R:333:37" left 333
	-af "ctrlBrow_R:333:37" top 37
	-af "ctrlBrow_L:367:37" left 367
	-af "ctrlBrow_L:367:37" top 37
	-af "ctrlEye_R:333:65" left 333
	-af "ctrlEye_R:333:65" top 65
	-af "ctrlEye_L:367:65" left 367
	-af "ctrlEye_L:367:65" top 65
	-af "ctrlCheek_R:333:94" left 333
	-af "ctrlCheek_R:333:94" top 94
	-af "ctrlCheek_L:367:94" left 367
	-af "ctrlCheek_L:367:94" top 94
	-af "ctrlNose_R:333:122" left 333
	-af "ctrlNose_R:333:122" top 122
	-af "ctrlNose_L:367:122" left 367
	-af "ctrlNose_L:367:122" top 122
	-af "ctrlMouth_M:346:151" left 346
	-af "ctrlMouth_M:346:151" top 151
	-af "ctrlMouthCorner_R:333:188" left 333
	-af "ctrlMouthCorner_R:333:188" top 188
	-af "ctrlMouthCorner_L:367:188" left 367
	-af "ctrlMouthCorner_L:367:188" top 188
	-af "ctrlBox:320:216" left 320
	-af "ctrlBox:320:216" top 216
	-af "EyeBrowInner_R:175:51" left 175
	-af "EyeBrowInner_R:175:51" top 51
	-af "EyeBrowMid1_R:160:49" left 160
	-af "EyeBrowMid1_R:160:49" top 49
	-af "EyeBrowMid2_R:148:50" left 148
	-af "EyeBrowMid2_R:148:50" top 50
	-af "EyeBrowMid3_R:136:53" left 136
	-af "EyeBrowMid3_R:136:53" top 53
	-af "EyeBrowOuter_R:127:60" left 127
	-af "EyeBrowOuter_R:127:60" top 60
	-af "upperLid_R:154:69" left 154
	-af "upperLid_R:154:69" top 69
	-af "upperOuterLid_R:141:76" left 141
	-af "upperOuterLid_R:141:76" top 76
	-af "lowerOuterLid_R:143:98" left 143
	-af "lowerOuterLid_R:143:98" top 98
	-af "lowerLid_R:154:99" left 154
	-af "lowerLid_R:154:99" top 99
	-af "lowerInnerLid_R:172:98" left 172
	-af "lowerInnerLid_R:172:98" top 98
	-af "upperInnerLid_R:173:76" left 173
	-af "upperInnerLid_R:173:76" top 76
	-af "outerLid_R:136:89" left 136
	-af "outerLid_R:136:89" top 89
	-af "innerLid_R:180:89" left 180
	-af "innerLid_R:180:89" top 89
	-af "upperSmileFold_R:151:122" left 151
	-af "upperSmileFold_R:151:122" top 122
	-af "Cheek_R:132:138" left 132
	-af "Cheek_R:132:138" top 138
	-af "NoseCorner_R:174:134" left 174
	-af "NoseCorner_R:174:134" top 134
	-af "Nostril_R:185:128" left 185
	-af "Nostril_R:185:128" top 128
	-af "Nose_M:194:133" left 194
	-af "Nose_M:194:133" top 133
	-af "NoseUnder_M:194:147" left 194
	-af "NoseUnder_M:194:147" top 147
	-af "NoseSide_R:177:117" left 177
	-af "NoseSide_R:177:117" top 117
	-af "NoseMiddle_M:194:108" left 194
	-af "NoseMiddle_M:194:108" top 108
	-af "upperLip_M:194:166" left 194
	-af "upperLip_M:194:166" top 166
	-af "lowerLip_M:194:182" left 194
	-af "lowerLip_M:194:182" top 182
	-af "Lip_R:163:165" left 163
	-af "Lip_R:163:165" top 165
	-af "upperLipA_R:184:165" left 184
	-af "upperLipA_R:184:165" top 165
	-af "upperLipB_R:173:165" left 173
	-af "upperLipB_R:173:165" top 165
	-af "lowerLipA_R:182:182" left 182
	-af "lowerLipA_R:182:182" top 182
	-af "lowerLipB_R:172:178" left 172
	-af "lowerLipB_R:172:178" top 178
	-af "EyeBrowMiddle_M:194:56" left 194
	-af "EyeBrowMiddle_M:194:56" top 56
	-af "Crease_R:152:163" left 152
	-af "Crease_R:152:163" top 163
	-af "upperCreaseB_R:157:152" left 157
	-af "upperCreaseB_R:157:152" top 152
	-af "upperCreaseA_R:168:147" left 168
	-af "upperCreaseA_R:168:147" top 147
	-af "lowerCreaseB_R:161:186" left 161
	-af "lowerCreaseB_R:161:186" top 186
	-af "lowerCreaseA_R:176:193" left 176
	-af "lowerCreaseA_R:176:193" top 193
	-af "lowerCrease_M:195:200" left 195
	-af "lowerCrease_M:195:200" top 200
	-af "SmileFold_R:144:157" left 144
	-af "SmileFold_R:144:157" top 157
	-af "EyeBrowRegion_L:303:58" left 303
	-af "EyeBrowRegion_L:303:58" top 58
	-af "EyeRegion_L:301:80" left 301
	-af "EyeRegion_L:301:80" top 80
	-af "EyeBrowInner_L:210:51" left 210
	-af "EyeBrowInner_L:210:51" top 51
	-af "EyeBrowMid1_L:228:49" left 228
	-af "EyeBrowMid1_L:228:49" top 49
	-af "EyeBrowMid2_L:240:50" left 240
	-af "EyeBrowMid2_L:240:50" top 50
	-af "EyeBrowMid3_L:252:53" left 252
	-af "EyeBrowMid3_L:252:53" top 53
	-af "EyeBrowOuter_L:261:60" left 261
	-af "EyeBrowOuter_L:261:60" top 60
	-af "upperLid_L:231:69" left 231
	-af "upperLid_L:231:69" top 69
	-af "upperOuterLid_L:250:76" left 250
	-af "upperOuterLid_L:250:76" top 76
	-af "lowerOuterLid_L:248:98" left 248
	-af "lowerOuterLid_L:248:98" top 98
	-af "lowerLid_L:231:99" left 231
	-af "lowerLid_L:231:99" top 99
	-af "lowerInnerLid_L:219:98" left 219
	-af "lowerInnerLid_L:219:98" top 98
	-af "upperInnerLid_L:218:76" left 218
	-af "upperInnerLid_L:218:76" top 76
	-af "outerLid_L:255:89" left 255
	-af "outerLid_L:255:89" top 89
	-af "innerLid_L:211:89" left 211
	-af "innerLid_L:211:89" top 89
	-af "upperSmileFold_L:229:122" left 229
	-af "upperSmileFold_L:229:122" top 122
	-af "Cheek_L:253:138" left 253
	-af "Cheek_L:253:138" top 138
	-af "NoseCorner_L:217:134" left 217
	-af "NoseCorner_L:217:134" top 134
	-af "Nostril_L:206:128" left 206
	-af "Nostril_L:206:128" top 128
	-af "NoseSide_L:214:117" left 214
	-af "NoseSide_L:214:117" top 117
	-af "Lip_L:228:165" left 228
	-af "Lip_L:228:165" top 165
	-af "upperLipA_L:207:165" left 207
	-af "upperLipA_L:207:165" top 165
	-af "upperLipB_L:218:165" left 218
	-af "upperLipB_L:218:165" top 165
	-af "lowerLipA_L:209:182" left 209
	-af "lowerLipA_L:209:182" top 182
	-af "lowerLipB_L:219:178" left 219
	-af "lowerLipB_L:219:178" top 178
	-af "Crease_L:239:163" left 239
	-af "Crease_L:239:163" top 163
	-af "upperCreaseB_L:234:152" left 234
	-af "upperCreaseB_L:234:152" top 152
	-af "upperCreaseA_L:223:147" left 223
	-af "upperCreaseA_L:223:147" top 147
	-af "lowerCreaseB_L:230:186" left 230
	-af "lowerCreaseB_L:230:186" top 186
	-af "lowerCreaseA_L:215:193" left 215
	-af "lowerCreaseA_L:215:193" top 193
	-af "SmileFold_L:248:157" left 248
	-af "SmileFold_L:248:157" top 157
	asSelectorfaceFormLayout;




asPopulateNameSpaceMenu "asSelectorface";
asShowSelJob;
asSelChange;
showWindow;
}
asSelectorface;

//-- ASTools Procedures Starts Here --//
global proc asSelChange ()
{
global int $asfileLoading;
global int $asSelChangeSwitching;
//int $showSelection=`optionVar -q asSowSelection`;  HERE !
if ($asfileLoading)
	return;
if (!`optionVar -q asShowSelection` && !`optionVar -q asShowKeyed` && !$asSelChangeSwitching)
	return;
int $undoState=`undoInfo -q -state`;
string $sel[]=`ls -sl`;
string $name,$obj,$nodeType,$projectName,$ann;
string $ctls[],$buffer[],$connections[];
int $numLetters,$numTok,$keyed;
string $ext=".xpm";
if (`asMayaVersionAsFloat`>=2011)
	$ext=".png";
if (`about -linux`)
	$ext=".xpm";
string $currImage,$buttonImageFile,$buttonImageFileOnK0,$buttonImageFileOnK1,$buttonImageFileOffK0,$buttonImageFileOffK1;
string $windows[]=`lsUI -windows`;
string $layout;
for ($window in $windows)
	{
	$layout="";
	if (size($window)>11)
		$layout="asSelector"+`substring $window 11 999`+"FormLayout";
	if (!`formLayout -q -ex $layout`)
		continue;
	$numLetters=size($layout);
	$name=`substring $layout 11 ($numLetters-10)`;
	$ctls=`formLayout -q -ca $layout`;
	for ($ctl in $ctls)
		{
		if (!`iconTextButton -q -ex $ctl`)
			continue;
		if (`optionVar -q asShowSelection` && !$asSelChangeSwitching)
			$selState="On";
		else
			$selState="Off";
		$keyed=0;
		$ann=`iconTextButton -q -ann $ctl`;
		$numTok=`tokenize $ann ";" $buffer`;
		for ($i=0;$i<$numTok;$i++)
			{
			$obj=`asSelectorResolveNameSpace $name $buffer[$i]`;
			if (!`stringArrayCount $obj $sel`)
				$selState="Off";
			if (`optionVar -q asShowKeyed` && !$asSelChangeSwitching && `objExists $obj`)
				{
				$connections=`listConnections -s 1 -d 0 $obj`;
				for ($node in $connections)
					{
					$nodeType=`objectType $node`;
					if (`gmatch $nodeType "animCurve*"`)
						$keyed=1;
					}
				}
			}

		$currImage=`iconTextButton -q -i1 $ctl`;
		if ($currImage=="")
			return;
		$numTok=`tokenize $currImage "_" $buffer`;
		if ($numTok<3)
			continue;
		$projectName=$buffer[0];
		for ($b=1;$b<size($buffer)-3;$b++)
			$projectName+="_"+$buffer[$b];
		$buttonImageFile=$projectName+"_"+$buffer[$numTok-3]+"_"+$buffer[$numTok-2]+"_"+$selState+"K"+$keyed+$ext;

		if ($buttonImageFile!=$currImage)
			iconTextButton -e -i $buttonImageFile $ctl;		
		}
	}

//PickerSelChange
if (!`optionMenu -q -ex asPickerOptionMenu`)
	return;
int $selectedTabIndex,$overrideColor;
string $picCtrls[],$selPicCtrls[],$selChrCtrls[],$tabLabels[];
string $picNs,$chrNs,$picCtrl,$chrCtrl;

if (`optionMenu -q -ex asPickerOptionMenu`)
	$chrNs=`optionMenu -q -v asPickerOptionMenu`;
if ($chrNs==":")
	$chrNs="";
if (`tabLayout -q -ex asPickerTabLayout`)
	{
	$tabLabels=`tabLayout -q -tl asPickerTabLayout`;
	$selectedTabIndex=`tabLayout -q -selectTabIndex asPickerTabLayout`;
	$picNs="picker_"+$tabLabels[$selectedTabIndex-1]+":";
	}
$picCtrls=`ls -type transform ($picNs+"*")`;
$selPicCtrls=`ls -sl -type transform ($picNs+"*")`;
$selChrCtrls=`ls -sl -type transform ($chrNs+"*")`;

//All .overrideColor==0 off first
if ($undoState) undoInfo -stateWithoutFlush 0;

for ($i=0;$i<size($picCtrls);$i++)
	{
	$overrideColor=0;
	$chrCtrl=`substitute $picNs $picCtrls[$i] $chrNs`;
	if (`optionVar -q asShowExtra`) $chrCtrl=`substitute "FK" $chrCtrl "FKExtra"`;
	if (`objExists $chrCtrl`)
		if (`optionVar -q asShowKeyed` && `asHaveAnimation $chrCtrl`)
			$overrideColor=13;
	setAttr ($picCtrls[$i]+".overrideColor") $overrideColor;
	}

if (!size($selPicCtrls) && !size($selChrCtrls))
	{
	if ($undoState) undoInfo -stateWithoutFlush 1;
	return;
	}

for ($i=0;$i<size($sel);$i++)
	{
	if (`optionVar -q asShowSelection`)
		$overrideColor=14;
	if (`gmatch $sel[$i] ($picNs+"*")`) // $picNs > $chrNs
		{
		$chrCtrl=`substitute $picNs $sel[$i] $chrNs`;
		if (`optionVar -q asShowExtra`) $chrCtrl=`substitute "FK" $chrCtrl "FKExtra"`;
		if (`objExists $chrCtrl` && `optionVar -q asShowSelection`)
			{
			select -d  $sel[$i];
			select -add $chrCtrl;
			if (`optionVar -q asShowKeyed` && `asHaveAnimation $chrCtrl`)
				$overrideColor=13;
			setAttr ($sel[$i]+".overrideColor") $overrideColor;
			}
		else
			print ("// "+$chrCtrl+" not found.\n");
		}
	if (`gmatch $sel[$i] ($chrNs+"*")`) // $chrNs > $picNs
		{
		if ($chrNs=="")
			$picCtrl=$picNs+$sel[$i];
		else
			$picCtrl=`substitute $chrNs $sel[$i] $picNs`;
		if (`optionVar -q asShowExtra`)
			{
			if (!`gmatch $picCtrl "*Extra*"`) continue;
			$picCtrl=`substitute "FKExtra" $picCtrl "FK"`;
			}
		if (`objExists $picCtrl`)
			setAttr ($picCtrl+".overrideColor") $overrideColor;
		}
	}
if ($undoState) undoInfo -stateWithoutFlush 1;
}

global proc float asMayaVersionAsFloat ()
{
float $version=2012;
if (`about -v`=="2016 Extension 2")
	return 2016.5;
if (`exists getApplicationVersionAsFloat`)
	return `getApplicationVersionAsFloat`;
string $versionString=`about -v`;
string $tempString[];
string $char;
tokenize $versionString $tempString;
//default to 2012, if versionString is not all numbers
for ($i=0;$i<size($tempString[0]);$i++)
	{
	$char=`substring $tempString[0] ($i+1) ($i+1)`;
	if (!`gmatch $char "[0-9]"`)
		return 2012;
	}
$version=$tempString[0];
return $version;
}

global proc asSelChangeToggle ()
{
global int $asSelChangeSwitching;
$asSelChangeSwitching=1;
string $sel[]=`ls -sl`;
select -cl;
asSelChange;
$asSelChangeSwitching=0;
select $sel;
}

global proc asCharChange (string $uiName)
{
string $gridOrder[];
if (`gridLayout -q -ex ($uiName+"GridLayout")`)
	{
	$gridOrder=`gridLayout -q -go ($uiName+"GridLayout")`;
	for ($i=1;$i<size($gridOrder)+1;$i++)
		if (`floatSlider -q -ex ($uiName+"FloatSlider"+$i)`)
			{
			$ann=`floatSlider -q -ann ($uiName+"FloatSlider"+$i)`;
			$resolvedName=`asPoserResolveNameSpace $uiName $ann`;
			if (`objExists $resolvedName`)
				connectControl ($uiName+"FloatSlider"+$i) $resolvedName;
			}
	}
asSelChange;
}

global proc asShowSelJob ()
{
global int $asSelChangeScripJobNr;
if ($asSelChangeScripJobNr)
	return;
$asSelChangeScripJobNr=`scriptJob -e "SelectionChanged" "asSelChange"`;
}

global proc string asSelectorResolveNameSpace (string $name, string $obj)
{
string $nameSpace;
string $tempString[];
if (`optionMenu -q -ex ("asSelector"+$name+"OptionMenu")`)
	$nameSpace=`optionMenu -q -v ("asSelector"+$name+"OptionMenu")`;
else if (`optionMenu -q -ex ("asPickerOptionMenu")`)
	$nameSpace=`optionMenu -q -v ("asPickerOptionMenu")`;
else if (`gmatch $name "*:*"`)
	{
	tokenize $name ":" $tempString;
	$nameSpace=$tempString[0]+":";
	}
if ($nameSpace==":")
	$nameSpace="";
string $extraObj;
//Extra control
if (`checkBox -q -ex ("asSelector"+$name+"ExtraCheckBox")`)
	if (`checkBox -q -v ("asSelector"+$name+"ExtraCheckBox")`)
		if (size($obj)>2)
			{
			$extraObj=`substring $obj 1 2`+"Extra"+`substring $obj 3 99`;
			if (`objExists ($nameSpace+$extraObj)`)
				return ($nameSpace+$extraObj);
			}
return ($nameSpace+$obj);
}

global proc asSelect (string $name, string $objs[])
{
for ($i=0;$i<size($objs);$i++)
	$objs[$i]=`asSelectorResolveNameSpace $name $objs[$i]`;

int $modifier=`getModifiers`;
if (($modifier %  2)==0)
	select -cl;
if ($objs[0]=="")
	{
	select -cl;
	return;
	}
for ($obj in $objs)
	if (!`objExists $obj`)
		error ("Object:\""+$obj+"\" does not exists !");
for ($obj in $objs)
	select -tgl $obj;
//enable hotKeys
string $formLayout="asSelector"+$name+"FormLayout";
if (`formLayout -q -ex $formLayout`)
	setFocus $formLayout;
}

global proc asKey (string $name, string $objs[])
{
for ($i=0;$i<size($objs);$i++)
	$objs[$i]=`asSelectorResolveNameSpace $name $objs[$i]`;

for ($obj in $objs)
	setKeyframe $obj;
select `ls -sl`;
asSelChange;
}

global proc asLinearKey (string $name, string $objs[])
{
for ($i=0;$i<size($objs);$i++)
	$objs[$i]=`asSelectorResolveNameSpace $name $objs[$i]`;

for ($obj in $objs)
	setKeyframe -itt linear -ott linear $obj;
select `ls -sl`;
asSelChange;
}

global proc asAlignIK2FK (string $name, string $objs[])
{
asAssembleAlignSwitchCmd $name $objs "asAlignFKIK" "IK2FK";
}

global proc asAlignFK2IK (string $name, string $objs[])
{
asAssembleAlignSwitchCmd $name $objs "asAlignFKIK" "FK2IK";
}

global proc asSwitchIK2FK (string $name, string $objs[])
{
asAssembleAlignSwitchCmd $name $objs "asSwitchFKIK" "IK2FK";
}

global proc asSwitchFK2IK (string $name, string $objs[])
{
asAssembleAlignSwitchCmd $name $objs "asSwitchFKIK" "FK2IK";
}

global proc asAssembleAlignSwitchCmd (string $name, string $objs[], string $alignSwitchCmd, string $W2K)
{
global int $asBakeFKIK;
$asBakeFKIK=0;
int $numLetters=size($objs[0]);
string $IK=`substring $objs[0] 5 ($numLetters-2)`;
string $side=`substring $objs[0] ($numLetters-1) $numLetters`;
eval ($alignSwitchCmd+" "+$name+" "+$IK+" "+$side+" "+$W2K);
}

global proc asAlignFKIK (string $name, string $IK, string $side, string $W2K)
{
global int $asBakeFKIK;
string $sel[]=`ls -sl`;
string $nameSpace=`asSelectorResolveNameSpace $name ""`;
string $controlCurve=$nameSpace+"FKIK"+$IK+$side;
if (!`objExists $controlCurve`)
	error ("Object:\""+$controlCurve+"\" does not exists !");
string $startJoint=`getAttr ($controlCurve+".startJoint")`;
string $middleJoint=`getAttr ($controlCurve+".middleJoint")`;
string $endJoint=`getAttr ($controlCurve+".endJoint")`;
string $curveCmd;
string $tempLoc1[],$tempLoc2[],$tempConstraint[],$tempConstraintAttrs[],$chainJoints[];
int $isSplineIK,$numIkCtrls,$cvNr;
float $IKCurveLenght,$dist,$stiff,$middleJointLenght,$endJointLenght;
float $pos[],$rot[],$posA[],$posB[],$tempFloat[],$alignIkToFloat[];
if (!`objExists ($nameSpace+"Pole"+$IK+$side)`)
	$isSplineIK=1;
string $requiredObj[]={($nameSpace+"MASTER"),($nameSpace+"FKX"+$startJoint+$side),($nameSpace+"IKX"+$startJoint+$side),($nameSpace+"IKX"+$middleJoint+$side)};
if ($isSplineIK)
	{
	$chainJoints=`asgetChainJoints ($nameSpace+$startJoint) ($nameSpace+$endJoint)`;
	for ($i=0;$i<size($chainJoints);$i++)
		$chainJoints[$i]=`substitute $nameSpace $chainJoints[$i] ""`;
	for ($i=1;$i<99;$i++)
		{
		if (!`objExists ($nameSpace+"IK"+$IK+$i+$side)`)
			break;
		$numIkCtrls=$i;
		}
	}
else
	$requiredObj=`stringArrayCatenate $requiredObj {($nameSpace+"Pole"+$IK+$side),($nameSpace+"FKX"+$endJoint+$side)}`;
for ($obj in $requiredObj)
	if (!`objExists $obj`)
		error ("Object:\""+$obj+"\" does not exists !");
float $charsize=`getAttr ($nameSpace+"MASTER.height")`;
int $autoKey=`autoKeyframe -q -st`;
if ($autoKey)
	autoKeyframe -st 0;
if ($asBakeFKIK)
	autoKeyframe -st 1;

string $deleteObjs[]={"IK2FKTempCurve","IK2FKTempXform","IK2FKTempXform2","IK2FKTempXform3","IK2FKTempCurveInfo"};
for ($i=0;$i<size($deleteObjs);$i++)
	if (`objExists $deleteObjs[$i]`)
		delete $deleteObjs[$i];

if ($W2K=="FK2IK" && !$isSplineIK)
	{
	$tempFloat=`xform -q -ws -t ($nameSpace+"FK"+$endJoint+$side)`;
	xform -ws -t $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"IK"+$IK+$side);
	$tempLoc1=`spaceLocator`;
	$tempConstraint=`pointConstraint ($nameSpace+"FKX"+$startJoint+$side) ($nameSpace+"FKX"+$endJoint+$side) $tempLoc1[0]`;
	$tempConstraintAttrs=`listAttr -ud $tempConstraint`;

	$middleJointLenght=`getAttr ($nameSpace+"FKOffset"+$middleJoint+$side+".tx")`;
	$endJointLenght=`getAttr ($nameSpace+"FKOffset"+$endJoint+$side+".tx")`;
	setAttr ($tempLoc1[0]+"_pointConstraint1."+$tempConstraintAttrs[0]) `abs($endJointLenght)`;
	setAttr ($tempLoc1[0]+"_pointConstraint1."+$tempConstraintAttrs[1]) `abs($middleJointLenght)`;
	delete $tempConstraint[0];
	$tempConstraint=`aimConstraint -aimVector 1 0 0 ($nameSpace+"FKX"+$middleJoint+$side) $tempLoc1[0]`;
	$tempLoc2=`spaceLocator`;
	parent $tempLoc2[0] $tempLoc1[0];
	setAttr -type float3 ($tempLoc2[0]+".translate") ($charsize/3.333) 0 0;
	$tempFloat=`xform -q -ws -t $tempLoc2[0]`;
	xform -ws -t $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"Pole"+$IK+$side);
	delete $tempLoc1;
	$tempFloat=`xform -q -ws -ro ($nameSpace+"AlignIKTo"+$endJoint+$side)`;
	xform -ws -ro $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"IK"+$IK+$side);
	if (`objExists ($nameSpace+"IKXToes"+$side)`)
		if (`attributeExists "roll" ($nameSpace+"IK"+$IK+$side)`)
			setAttr ($nameSpace+"IK"+$IK+$side+".roll") 0;
	}
if ($W2K=="FK2IK" && $isSplineIK)
	{
	$curveCmd="curve -n IK2FKTempCurve -d 1 ";
	for ($i=0;$i<size($chainJoints);$i++)
		{
		if (`objExists ($nameSpace+"FKX"+$chainJoints[$i]+$side)`)
			$pos=`xform -q -ws -t ($nameSpace+"FKX"+$chainJoints[$i]+$side)`;
		else // Tail does not have FKX joint at last $chainJoints, so resolve position
			{
			createNode -n IK2FKTempXform -p ($nameSpace+"FKX"+$chainJoints[($i-1)]+$side) transform;
			$pos=`getAttr ($nameSpace+$chainJoints[$i]+$side+".t")`;
			setAttr -type float3 IK2FKTempXform.t $pos[0] $pos[1] $pos[2];
			$pos=`xform -q -ws -t IK2FKTempXform`;
			delete IK2FKTempXform;
			}
		$curveCmd+=" -p "+$pos[0]+" "+$pos[1]+" "+$pos[2];
		}
	eval ($curveCmd);
	rebuildCurve -ch 0 -rpo 1 -rt 0 -end 1 -kr 0 -kcp 0 -kep 1 -kt 0 -s ($numIkCtrls-1) -d 3 -tol 0.0004 IK2FKTempCurve;

	createNode -n IK2FKTempCurveInfo curveInfo;
	connectAttr ($nameSpace+"IK"+$IK+"Curve_M.worldSpace[0]") IK2FKTempCurveInfo.inputCurve;
	$IKCurveLenght=`getAttr IK2FKTempCurveInfo.arcLength`;
	delete IK2FKTempCurveInfo;

	for ($i=1;$i<$numIkCtrls+1;$i++)
		{
		$cvNr=$i;
		if ($i==1) $cvNr=0;
		if ($i==$numIkCtrls) $cvNr=$i+1;
		$pos=`xform -q -ws -t IK2FKTempCurve.cv[$cvNr]`;
		xform -ws -t $pos[0] $pos[1] $pos[2] ($nameSpace+"IK"+$IK+$i+$side);
		if ($i==1 || $i==$numIkCtrls)
			{
			if ($i==1) createNode -n IK2FKTempXform -p ($nameSpace+"IK"+$IK+"0AlignTo"+$side) transform;
			if ($i==$numIkCtrls) createNode -n IK2FKTempXform -p ($nameSpace+"IK"+$IK+$numIkCtrls+"AlignTo"+$side) transform;
			createNode -n IK2FKTempXform2 transform;
			createNode -n IK2FKTempXform3 transform;
			parent IK2FKTempXform3 IK2FKTempXform;
			setAttr -type float3 IK2FKTempXform3.t 0 0 0;
			if ($i==1) $pos=`xform -q -ws -t IK2FKTempCurve.cv[1]`;
			if ($i==$numIkCtrls) $pos=`xform -q -ws -t IK2FKTempCurve.cv[$numIkCtrls]`;
			xform -ws -t $pos[0] $pos[1] $pos[2] IK2FKTempXform2;
			aimConstraint -aimVector 1 0 0 -worldUpType objectrotation -worldUpObject ($nameSpace+"FKX"+$chainJoints[0]+$side) -worldUpVector 0 1 0 IK2FKTempXform2 IK2FKTempXform;
			if ($i==$numIkCtrls)
				{
				setAttr IK2FKTempXform_aimConstraint1.aimVectorX -1;
				connectAttr -f ($nameSpace+$chainJoints[(size($chainJoints)-1)]+$side+".worldMatrix[0]") IK2FKTempXform_aimConstraint1.worldUpMatrix;
				}
			$rot=`xform -q -ws -ro IK2FKTempXform3`;
			if ($i==$numIkCtrls && `objExists ($nameSpace+"AlignIKTo"+$chainJoints[(size($chainJoints)-1)]+$side)`)//e.g chest
				$rot=`xform -q -ws -ro ($nameSpace+"AlignIKTo"+$chainJoints[(size($chainJoints)-1)]+$side)`;
			xform -ws -ro $rot[0] $rot[1] $rot[2] ($nameSpace+"IK"+$IK+$i+$side);

			//calculate stiffness $IKCurveLenght
			if ($i==1) 					 {$posA=`xform -q -ws -t IK2FKTempCurve.cv[0]`;   $posB=`xform -q -ws -t IK2FKTempCurve.cv[1]`;}
			if ($i==$numIkCtrls) {$posA=`xform -q -ws -t IK2FKTempCurve.cv[$i+1]`;$posB=`xform -q -ws -t IK2FKTempCurve.cv[$i]`;}
			$dist=`mag<<$posA[0]-$posB[0],$posA[1]-$posB[1],$posA[2]-$posB[2]>>`;
			$stiff=($dist/($IKCurveLenght/2.0))*10;
			if ($stiff<0) $stiff=0;
			if ($stiff>10) $stiff=10;
			setAttr ($nameSpace+"IK"+$IK+$i+$side+".stiff") $stiff;
			delete IK2FKTempXform IK2FKTempXform2 IK2FKTempXform3;
			}
		}
	delete IK2FKTempCurve;
	print "// Switching from FK to Curve-Based-IK, Target will not fully Align.\n";
	}
if ($W2K=="IK2FK" && !$isSplineIK)
	{
	$tempFloat=`xform -q -ws -ro ($nameSpace+"IKX"+$startJoint+$side)`;
	xform -ws -ro $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"FK"+$startJoint+$side);
	$tempFloat=`xform -q -ws -ro ($nameSpace+"IKX"+$middleJoint+$side)`;
	xform -ws -ro $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"FK"+$middleJoint+$side);
	$tempFloat=`xform -q -ws -ro ($nameSpace+"IKX"+$endJoint+$side)`;
	xform -ws -ro $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"FK"+$endJoint+$side);
	if (`objExists ($nameSpace+"IKXToes"+$side)`)
		{
		$tempFloat=`xform -q -ws -ro ($nameSpace+"IKXToes"+$side)`;
		xform -ws -ro $tempFloat[0] $tempFloat[1] $tempFloat[2] ($nameSpace+"FKToes"+$side);
		}
	}
if ($W2K=="IK2FK" && $isSplineIK)
	{
	for ($i=0;$i<size($chainJoints);$i++)
		{
		if (!`objExists ($nameSpace+"IKX"+$chainJoints[$i]+$side)` || !`objExists ($nameSpace+"FK"+$chainJoints[$i]+$side)`)
			continue;
		// RootX_M.legLock warning
		if ($chainJoints[$i]=="Root")
			if (`attributeExists legLock RootX_M`)
				if (`getAttr RootX_M.legLock`!=10)
					print ("// Switching from IK to FK for the Spine, Set RootX_M.legLock to 10, for more accurate switching.\n");
		$pos=`xform -q -ws -t ($nameSpace+"IKX"+$chainJoints[$i]+$side)`;
		$rot=`xform -q -ws -ro ($nameSpace+"IKX"+$chainJoints[$i]+$side)`;
		//inbetween, to use last inbetweener`s rot
		for ($numParts=0;$numParts<99;$numParts++)
			if (!`objExists ($chainJoints[$i]+"Part"+($numParts+1)+$side)`)
				break;
		if ($numParts>0)
			$rot=`xform -q -ws -ro ($nameSpace+$chainJoints[$i]+"Part"+$numParts+$side)`;
		xform -ws -t $pos[0] $pos[1] $pos[2] -ro $rot[0] $rot[1] $rot[2] ($nameSpace+"FK"+$chainJoints[$i]+$side);
		}
	}

if ($autoKey)
	autoKeyframe -st 1;
if (!$autoKey && $asBakeFKIK)
	autoKeyframe -st 0;
select $sel;
}

global proc asSwitchFKIK (string $name, string $IK, string $side, string $W2K)
{
string $sel[]=`ls -sl`;
string $nameSpace=`asSelectorResolveNameSpace $name ""`;
string $controlCurve=$nameSpace+"FKIK"+$IK+$side;
string $poleCurve=$nameSpace+"Pole"+$IK+$side;
if (!`objExists $controlCurve`)
	error ("Object:\""+$controlCurve+"\" does not exists !");
string $startJoint=`getAttr ($controlCurve+".startJoint")`;
string $middleJoint=`getAttr ($controlCurve+".middleJoint")`;
string $endJoint=`getAttr ($controlCurve+".endJoint")`;
string $chainJoints[];
int $isSplineIK,$numIkCtrls;
if (!`objExists ($nameSpace+"Pole"+$IK+$side)`)
	$isSplineIK=1;
string $requiredObj[]={($nameSpace+"MASTER"),($nameSpace+"FKX"+$startJoint+$side),($nameSpace+"IKX"+$startJoint+$side),($nameSpace+"IKX"+$middleJoint+$side)};
if ($isSplineIK)
	{
	$chainJoints=`asgetChainJoints ($nameSpace+$startJoint) ($nameSpace+$endJoint)`;
	for ($i=0;$i<size($chainJoints);$i++)
		$chainJoints[$i]=`substitute $nameSpace $chainJoints[$i] ""`;
	for ($i=1;$i<99;$i++)
		{
		if (!`objExists ("IK"+$IK+$i+$side)`)
			break;
		$numIkCtrls=$i;
		}
	}
else
	$requiredObj=`stringArrayCatenate $requiredObj {($nameSpace+"Pole"+$IK+$side),($nameSpace+"FKX"+$endJoint+$side)}`;
for ($obj in $requiredObj)
	if (!`objExists $obj`)
		error ("Object:\""+$obj+"\" does not exists !");
int $Blend;
int $BlendInverse=10;
int $onOff;
if ($W2K=="FK2IK")
	{
	$Blend=10;
	$BlendInverse=0;
	$onOff=1;
	}

if ($W2K=="FK2IK" && `getAttr ($controlCurve+".FKIKBlend")`>0)
	{
	warning ("Could not switch FK2IK, because \"FKIKBlend\" is not \"0\"\n");
	return;
	}
if ($W2K=="IK2FK" && `getAttr ($controlCurve+".FKIKBlend")`<10)
	{
	warning ("Could not switch IK2FK, because \"FKIKBlend\" is not \"10\"\n");
	return;
	}

int $autoKey=`autoKeyframe -q -st`;

currentTime (`currentTime -q` -1);
setAttr ($controlCurve+".FKIKBlend") $BlendInverse;
if ($autoKey && !$isSplineIK)
	{
	setKeyframe ($controlCurve+".FKIKBlend");
	setKeyframe ($poleCurve+".follow");	

	setKeyframe ($nameSpace+"FK"+$startJoint+$side+".rotate");
	setKeyframe ($nameSpace+"FK"+$middleJoint+$side+".rotate");
	setKeyframe ($nameSpace+"FK"+$endJoint+$side+".rotate");
	setKeyframe ($nameSpace+"IK"+$IK+$side+".translate");
	setKeyframe ($nameSpace+"IK"+$IK+$side+".rotate");
	setKeyframe ($nameSpace+"Pole"+$IK+$side+".translate");

	if (`objExists ($nameSpace+"IKXToes"+$side)`)
		{
		setKeyframe ($nameSpace+"FKToes"+$side+".rotate");
		if (`attributeExists "roll" ($nameSpace+"IK"+$IK+$side)`)
			setKeyframe ($nameSpace+"IK"+$IK+$side+".roll");
		}
	}
if ($autoKey && $isSplineIK)
	{
	setKeyframe ($controlCurve+".FKIKBlend");
	for ($i=0;$i<size($chainJoints);$i++)
		if (`objExists ($nameSpace+"FK"+$chainJoints[$i]+$side)`)
			{
			setKeyframe ($nameSpace+"FK"+$chainJoints[$i]+$side+".t");
			setKeyframe ($nameSpace+"FK"+$chainJoints[$i]+$side+".r");
			}
	for ($i=1;$i<$numIkCtrls+1;$i++)
		if (`objExists ("IK"+$IK+$i+$side)`)
			{
			setKeyframe ("IK"+$IK+$i+$side+".t");
			setKeyframe ("IK"+$IK+$i+$side+".r");
			if (`attributeExists "stiff" ("IK"+$IK+$i+$side)`)
				setKeyframe ("IK"+$IK+$i+$side+".stiff");
			}
	}

currentTime (`currentTime -q` +1);
asAlignFKIK $name $IK $side $W2K;
setAttr ($controlCurve+".FKIKBlend") $Blend;

if ($autoKey && !$isSplineIK)
	{
	setAttr ($poleCurve+".follow") 0;

	setKeyframe ($controlCurve+".FKIKBlend");
	setKeyframe ($poleCurve+".follow");

	setKeyframe ($nameSpace+"FK"+$startJoint+$side+".rotate");
	setKeyframe ($nameSpace+"FK"+$middleJoint+$side+".rotate");
	setKeyframe ($nameSpace+"FK"+$endJoint+$side+".rotate");
	setKeyframe ($nameSpace+"IK"+$IK+$side+".translate");
	setKeyframe ($nameSpace+"IK"+$IK+$side+".rotate");
	setKeyframe ($nameSpace+"Pole"+$IK+$side+".translate");
	if (`objExists ($nameSpace+"IKXToes"+$side)`)
		{
		setKeyframe ($nameSpace+"FKToes"+$side+".rotate");
		if (`attributeExists "roll" ($nameSpace+"IK"+$IK+$side)`)
			setKeyframe ($nameSpace+"IK"+$IK+$side+".roll");
		}
	}
if ($autoKey && $isSplineIK)
	{
	setKeyframe ($controlCurve+".FKIKBlend");
	for ($i=0;$i<size($chainJoints);$i++)
		if (`objExists ($nameSpace+"FK"+$chainJoints[$i]+$side)`)
			{
			setKeyframe ($nameSpace+"FK"+$chainJoints[$i]+$side+".t");
			setKeyframe ($nameSpace+"FK"+$chainJoints[$i]+$side+".r");
			}
	for ($i=1;$i<$numIkCtrls+1;$i++)
		if (`objExists ("IK"+$IK+$i+$side)`)
			{
			setKeyframe ("IK"+$IK+$i+$side+".t");
			setKeyframe ("IK"+$IK+$i+$side+".r");
			if (`attributeExists "stiff" ("IK"+$IK+$i+$side)`)
				setKeyframe ("IK"+$IK+$i+$side+".stiff");
			}
	}

select $sel;
}

global proc string[] asgetChainJoints (string $startJoint, string $endJoint)
{
int $startJointIsParentNr;
string $chainJoints[];
string $tempString[]=`ls -l $endJoint`;
tokenize $tempString[0] "|" $tempString;
for ($i=size($tempString)-1;$i>-1;$i--)
	{
	$startJointIsParentNr=$i;
	if ($tempString[$i]==$startJoint)
		{
		break;
		}
	}
for ($i=$startJointIsParentNr;$i<size($tempString);$i++)
	$chainJoints[size($chainJoints)]=$tempString[$i];
return $chainJoints;
}

global proc asPopulateNameSpaceMenu (string $name)
{
string $optionMenu=$name+"OptionMenu";
string $nameSpacesList[]=`namespaceInfo -lon`;
$nameSpacesList=`stringArrayRemove {"UI"} $nameSpacesList`;
$nameSpacesList[size($nameSpacesList)]="";
string $itemList[]=`optionMenu -q -ils $optionMenu`;
$nameSpacesList=`sort $nameSpacesList`;
for ($item in $itemList)
	deleteUI $item;

for ($nameSpace in $nameSpacesList)
	if (`objExists ($nameSpace+":MASTER")`)
		if (`attributeExists "version" ($nameSpace+":MASTER")`)
			if (`asFilterCheck $name $nameSpace`)
				menuItem -p $optionMenu -l ($nameSpace+":");

if (!`optionMenu -q -ni ($name+"OptionMenu")`)
	{
	if ($name=="bodySetup" || `gmatch $name "asPoser*"`)
		menuItem -p $optionMenu -l "None";
	else
		menuItem -p $optionMenu -l ":";
	}
}

global proc int asFilterCheck (string $name, string $nameSpace)
{
int $result=0;
string $filterString=`optionVar -q ("asSelectorFilter_"+$name)`;
if ($filterString=="" || $filterString=="0")
	return 1;
string $references[]=`file -q -r`;
for ($i=0;$i<size($references);$i++)
	{
	$refNameSpace=`file -q -ns $references[$i]`;
	if ($refNameSpace==$nameSpace)
		if (`gmatch $references[$i] $filterString`)
			$result=1;
	}
return $result;
}

global proc asFilterNameSpaceMenuUI (string $name)
{
string $filterString=`optionVar -q ("asSelectorFilter_"+$name)`;
if ($filterString=="0")
	$filterString="";
if (`window -q -ex ("SelectorFilter_"+$name)`)
	deleteUI ("SelectorFilter_"+$name);
window ("SelectorFilter_"+$name);
columnLayout;
textFieldGrp -tx $filterString -cc ("asSetFilterNameSpaceMenu "+$name) -l "Reference File Filter. (e.g. *characters*)" -cw 1 200 ("asSelectorFilterTextFieldGrp_"+$name);
showWindow;
}

global proc asSetFilterNameSpaceMenu (string $name)
{
string $filterString=`textFieldGrp -q -tx ("asSelectorFilterTextFieldGrp_"+$name)`;
optionVar -sv ("asSelectorFilter_"+$name) $filterString;
asPopulateNameSpaceMenu $name;
}

global proc asSetNameSpaceFromSelection (string $uiName)
{
asPopulateNameSpaceMenu $uiName;
string $sel[]=`ls -sl`;
string $tempString[],$ils[];
if (size($sel))
	{
	tokenize $sel[0] ":" $tempString;
	$ils=`optionMenu -q -ils ($uiName+"OptionMenu")`;
	for ($i=0;$i<size($ils);$i++)
		if (`menuItem -q -l $ils[$i]`==($tempString[0]+":"))
			{
			optionMenu -e -sl ($i+1) ($uiName+"OptionMenu");
			asSelChange;
			}
	}
print "// Setting nameSpace from selected object\n";
}

global proc asCopyToClipBoard (string $uiName, int $anim)
{
string $cmd=`asPoserGetCmd $uiName $anim`;
if (!$anim)
	menuItem -e -en 1 -c $cmd ($uiName+"PosePaste");
else
	menuItem -e -en 1 -c ($cmd+" 0") ($uiName+"AnimPaste");
}

global proc string[] asGetControlSetsFromUI (string $uiName)
{
int $selectedTabIndex;
string $controlSets[];
string $tempString[],$tabLabels[];
string $controlSetsText;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
if (`text -q -ex ($uiName+"ControlSetsText")`)//Selector
	{
	$controlSetsText=`text -q -l ($uiName+"ControlSetsText")`;
	tokenize $controlSetsText $tempString;
	for ($i=0;$i<size($tempString);$i++)
		if (`objExists ($nameSpace+$tempString[$i])`)
			$controlSets[size($controlSets)]=$nameSpace+$tempString[$i];
	}
else if ($uiName=="asPicker" && `tabLayout -q -ex asPickerTabLayout`)//Picker
	{
	$tabLabels=`tabLayout -q -tl asPickerTabLayout`;
	$selectedTabIndex=`tabLayout -q -selectTabIndex asPickerTabLayout`;
	if (`gmatch $tabLabels[$selectedTabIndex-1] "*face*"`)
		$controlSets[0]=$nameSpace+"FaceControlSet";
	}
else if ($uiName=="asPoserDefault" && `menuItem -q -ex asPoserControlSetsMenu`)//PoserDesigner
	{
	$tempString=`menu -q -ia asPoserControlSetsMenu`;
	for ($i=0;$i<size($tempString);$i++)
		if (`menuItem -q -cb $tempString[$i]`)
			$controlSets[size($controlSets)]=$nameSpace+`menuItem -q -l $tempString[$i]`;
	}
else
	$controlSets[0]=$nameSpace+"ControlSet";

return $controlSets;
}

global proc asDeleteStaticChannels (string $uiName)
{
if (`confirmDialog -title "Confirm" -message 
	("Clean animation ?\n"
	+"This will delete static channels,\n"
	+"which means remove all animation where the value is not changing")
    -button "Yes" -button "No" -defaultButton "Yes"
    -cancelButton "No" -dismissString "No"`!="Yes")
	return;
string $sel[]=`ls -sl`;
string $controlSets[]=`asGetControlSetsFromUI $uiName`;
select $controlSets;
evalEcho "delete -staticChannels -unitlessAnimationCurves false -hierarchy none -controlPoints 0 -shape 1";
print ("// Static channels cleaned\n");
select $sel;
}
	
global proc string asPoserGetCmd (string $uiName, int $anim)
{
global string $gChannelBoxName;
global string $gMainProgressBar;
string $sel[]=`ls -sl`;
string $selectedMainAttrs[]=`channelBox -q -sma $gChannelBoxName`;
string $selectedShapeAttrs[]=`channelBox -q -ssa $gChannelBoxName`;
string $selectedHistoryAttrs[]=`channelBox -q -sha $gChannelBoxName`;
string $selectedOutputAttrs[]=`channelBox -q -soa $gChannelBoxName`;
string $selectedAttrs[];
$selectedAttrs=`stringArrayCatenate $selectedMainAttrs $selectedShapeAttrs`;
$selectedAttrs=`stringArrayCatenate $selectedAttrs $selectedHistoryAttrs`;
$selectedAttrs=`stringArrayCatenate $selectedAttrs $selectedOutputAttrs`;
int $ctrlButton,$altButton;
if ((`getModifiers`/4) %  2)
	$ctrlButton=1;
if ((`getModifiers`/8) %  2)
	$altButton=1;
int $onlySel;
if ($uiName=="asPoserDefault")
	{
	if (`checkBox -q -ex asPoserOnlySel`)
		$onlySel=`checkBox -q -v asPoserOnlySel`;
	}
else if ($altButton || $ctrlButton)
	$onlySel=1;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
string $cmd;
string $controls[],$buffer[];
int $weightedTangents[];
int $onlyOneObj,$onlyOneAttr;
string $connectObj;
string $controlSets[]=`asGetControlSetsFromUI $uiName`;
if (!$onlySel && !size($controlSets))
	error "No ControlSets";

//determine the name for poserAnimFile
string $animationFile,$animationFilePath;
string $gridOrder[];
int $childNum;
if (`gmatch $uiName "asPoser*"`)
	{
	$gridOrder=`gridLayout -q -go ($uiName+"GridLayout")`;
	for ($i=1;$i<size($gridOrder)+1;$i++)
		if (`gmatch $gridOrder[$i-1] "asPoser*"`)
			$childNum=$i;
	$childNum++;

	$animationFile="untitled_"+$childNum;
	$animationFilePath=`internalVar -utd`+"AdvancedSkeleton/Poser/untitled/";
	}
else
	{
	$animationFile="ClipBoard";
	$animationFilePath=`internalVar -utd`+"AdvancedSkeleton/Selector/";
	}

string $animCurves[];

if ($onlySel)
	{
	for ($i=$y=0;$i<size($sel);$i++)
		{
		if (`gmatch $sel[$i] ($nameSpace+"*")`)
			{
			tokenize $sel[$i] ":" $buffer;
			$controls[$y]=$buffer[size($buffer)-1];
			$y++;
			}
		}
	}
else
	{
	if (!`objExists $controlSets[0]`)
		error ("Object :\""+$controlSets[0]+"\" does not exists !\n");
	$controls=`sets -q $controlSets`;
	for ($i=0;$i<size($controls);$i++)
		$controls[$i]=`substitute  $nameSpace $controls[$i] ""`;
	}
string $attrs[];
if (size($controls)<1)
	error "No Controls Available!";
evalDeferred ("progressBar -e -ep "+$gMainProgressBar);
progressBar -e -st "Storing Data" -bp -ii 1 -min 0 -max (size($controls)) $gMainProgressBar;
select -cl;

if ($anim)
	{
	createNode -n poserAnimationInfo transform;
	addAttr -ln "cmd" -dt "string" poserAnimationInfo;
	select poserAnimationInfo;
	}

	{
for ($obj in $controls)
	{
	progressBar -e -s 1 $gMainProgressBar;
	if (`progressBar -q -ic $gMainProgressBar`)
		error "Interrupted";
	$allKeyableAttrs=`listAttr -k -m -sn ($nameSpace+$obj)`;
	if ($onlySel && (size($selectedAttrs)>0))
		$attrs=$selectedAttrs;
	else
		$attrs=$allKeyableAttrs;
	for ($attr in $attrs)
		for ($allKeyableAttr in $allKeyableAttrs)
			{
			if (`getAttr -l ($nameSpace+$obj+"."+$attr)`)
				continue;
			if ($attr==$allKeyableAttr)
				{
				if (!$anim)
					$cmd+=$obj+"."+$attr+" "+`getAttr ($nameSpace+$obj+"."+$attr)`+";";
				else
					{
					//Animation
					$animCurves=`listConnections -type animCurve -s 1 -d 0 ($nameSpace+$obj+"."+$attr)`;
					for ($y=0;$y<size($animCurves);$y++)
						{
						select -add $animCurves[$y];
						$cmd+=$obj+"."+$attr+" "+`getAttr ($nameSpace+$obj+"."+$attr)`+" "+$animCurves[$y]+";";
						}
					}
				}
			}
		}
	}

if ($anim)
	{
	setAttr -type "string" poserAnimationInfo.cmd $cmd;
	if (!`file -q -ex $animationFilePath`)
		sysFile -md $animationFilePath;
	file -f -op "v=0" -typ "mayaAscii" -es ($animationFilePath+$animationFile+".ma");
	delete poserAnimationInfo;
	}

if ($cmd!="")
	{
	if (!$anim)
		$cmd="asSetAttrs "+$uiName+" \""+$cmd+"\"";
	else
		$cmd="asLoadAttrs "+$uiName;
	}

select $sel;
return $cmd;
}

global proc asSetAttrs (string $uiName, string $cmds)
{
int $ctrlButton,$altButton;
if ((`getModifiers`/4) %  2)
	$ctrlButton=1;
if ((`getModifiers`/8) %  2)
	$altButton=1;
string $buffer[],$buffer2[];
string $objAttr;
float $value;
int $numTok=`tokenize $cmds ";" $buffer`;
int $showWarning;
string $warningMsg="The following attributes can not be set:";

for ($i=0;$i<$numTok;$i++)
	{
	tokenize $buffer[$i] $buffer2;
	$objAttr=$buffer2[0];
	$value=$buffer2[1];
	$objAttr=`asPoserResolveNameSpace $uiName $objAttr`;
	if (($ctrlButton||$altButton) && `gmatch $objAttr "*MASTER.*"`)
		continue;
	if (`objExists $objAttr`)
		catch (`eval ("setAttr "+$objAttr+" "+$value)`);
	else
		{
		$showWarning=1;
		$warningMsg+=$objAttr+",";
		}
	}
if ($showWarning)
	warning $warningMsg;
}

global proc asLoadAttrs (string $uiName, int $childNum)
{
string $sel[]=`ls -sl`;
int $autoKey=`autoKeyframe -q -st`;
if ($autoKey)
	autoKeyframe -e -st 0;
createNode -n tempXform transform;
int $shiftButton,$ctrlButton,$altButton;
if (`getModifiers` %  2)
	$shiftButton=1;
if ((`getModifiers`/4) %  2)
	$ctrlButton=1;
if ((`getModifiers`/8) %  2)
	$altButton=1;
float $timeOffset=0;
if ($shiftButton)
	$timeOffset=`currentTime -q`;
string $buffer[],$buffer2[],$buffer3[],$tempString[];
string $obj,$attr,$objAttr,$animCurve,$newAnimCurve;
float $value;

string $animationFile,$projectName;

if ($childNum==0)
	{
	$projectName="Selector";
	$animationFile=`internalVar -utd`+"AdvancedSkeleton/Selector/ClipBoard.ma";
	}
else
	{
	string $icon=`iconTextButton -q -i ($uiName+"IconTextButton"+$childNum)`;
	string $tempString[];
	tokenize $icon "/" $tempString;
	$projectName=$tempString[size($tempString)-2];
	$animationFile=`substitute "[.][a-z][a-z][a-z]" $icon ".ma"`;
	}
file -r -type "mayaAscii" -namespace $projectName -options "v=0;p=17" $animationFile;

string $cmds=`getAttr ($projectName+":poserAnimationInfo.cmd")`;
int $numTok=`tokenize $cmds ";" $buffer`;
int $showWarning;
string $warningMsg="The following attributes can not be set:";
for ($i=0;$i<$numTok;$i++)
	{
	tokenize $buffer[$i] $buffer2;
	$objAttr=$buffer2[0];
	tokenize $objAttr "." $buffer3;
	$obj=$buffer3[0];
	$attr=$buffer3[1];
	$value=$buffer2[1];
	$animCurve=$buffer2[2];
	$objAttr=`asPoserResolveNameSpace $uiName $objAttr`;
	if (($ctrlButton||$altButton) && `gmatch $objAttr "*MASTER.*"`)
		continue;
	if (`objExists $objAttr`)
		{
		catch (`eval ("setAttr "+$objAttr+" "+$value)`);
		if (!`attributeExists $attr tempXform`)
			addAttr -k 1 -ln $attr -at double tempXform;
		connectAttr -f ($projectName+":"+$animCurve+".output") ("tempXform."+$attr);
		copyKey -time ":" -hierarchy none -at $attr tempXform;
		pasteKey -option merge -copies 1 -connect 0 -timeOffset $timeOffset -floatOffset 0 -valueOffset 0 {$objAttr};
		}
	else
		{
		$showWarning=1;
		$warningMsg+=$objAttr+",";
		}
	}
if ($showWarning)
	warning $warningMsg;

if (`objExists tempXform`)
	delete tempXform;
file -rr  $animationFile;
select $sel;
if ($autoKey)
	autoKeyframe -e -st 1;
}

global proc asKeyAttrs (string $uiName, string $cmds)
{
int $ctrlButton,$altButton;
if ((`getModifiers`/4) %  2)
	$ctrlButton=1;
if ((`getModifiers`/8) %  2)
	$altButton=1;
string $buffer[],$buffer2[],$spaceBuffer[];
string $objAttr,$previousObjAttr,$restOfBuffers;
float $time,$value,$currentValue;
float $currentTime=`currentTime -q`;
int $numTok=`tokenize $cmds ";" $buffer`;
int $showWarning,$firstValueSet;
string $warningMsg="The following attributes can not be keyed:";
float $firstValue;
for ($i=0;$i<$numTok;$i++)
	{
	tokenize $buffer[$i] $buffer2;
	$objAttr=$buffer2[0];
	$objAttr=`asPoserResolveNameSpace $uiName $objAttr`;
	$restOfBuffers="";
	if ($objAttr!=$previousObjAttr)
		$firstValueSet=0;
	$previousObjAttr=$objAttr;
	for ($y=1;$y<size($buffer2);$y++)
		$restOfBuffers+=$buffer2[$y]+" ";
	if (`objExists $objAttr`)
		{
		tokenize $restOfBuffers $spaceBuffer;
		for ($y=0;$y<size($spaceBuffer);$y++)
			{
			//TimeOffset
			if ($spaceBuffer[$y]=="-t" && ($ctrlButton||$altButton))
				{
				$time=$spaceBuffer[$y+1];
				$spaceBuffer[$y+1]=$time+$currentTime;
				}
			//ValueOffset
			if ($spaceBuffer[$y]=="-v" && $ctrlButton)
				{
				$value=$spaceBuffer[$y+1];
				$currentValue=`getAttr $objAttr`;
				if (!$firstValueSet)
				$firstValue=$value;
				$firstValueSet=1;
				$spaceBuffer[$y+1]=$value+$currentValue-$firstValue;
				}
			}
		$restOfBuffers="";
		for ($y=0;$y<size($spaceBuffer);$y++)
			$restOfBuffers+=$spaceBuffer[$y]+" ";
		eval ($restOfBuffers+$objAttr);
		}
	else
		{
		$showWarning=1;
		$warningMsg+=$objAttr+",";
		}
	}
if ($showWarning)
	warning $warningMsg;
}

global proc asPoseView (string $uiName, int $childNum)
{
string $icon=`iconTextButton -q -i ($uiName+"IconTextButton"+$childNum)`;
int $anim=`rowColumnLayout -q -ann ($uiName+"RowColumnLayout"+$childNum)`;
string $tempString[];
tokenize $icon "/" $tempString;
string $projectName=$tempString[size($tempString)-2];

string $mediaFile;
if ($anim)
	$mediaFile=`substitute "[.][a-z][a-z][a-z]" $icon ".avi"`;
else
	$mediaFile=`substitute "[.][a-z][a-z][a-z]" $icon ".jpg"`;
print ("// "+$mediaFile+"\n");
system ("load "+$mediaFile);
}

global proc asPoseObjects (string $uiName, string $button,string $action)
{
string $cmd=`iconTextButton -q -c $button`;
string $buffer[],$buffer2[];
string $objAttr,$value;
tokenize $cmd "\"" $buffer;
$cmd=$buffer[1];
int $numTok=`tokenize $cmd ";" $buffer`;
int $showWarning;
string $warningMsg="The following objects can not be found:";
if ($action==" select -add")
select -cl;
for ($i=0;$i<$numTok;$i++)
	{
	tokenize $buffer[$i] $buffer2;
	$objAttr=$buffer2[0];
	$value=$buffer2[1];
	tokenize $objAttr "." $buffer2;
	$obj=$buffer2[0];
	if ($action!=" select -add")
		$obj=$objAttr;
	$obj=`asPoserResolveNameSpace $uiName $obj`;
	if (`objExists $obj`)
		eval ($action+" "+$obj);
	else
		{
		$showWarning=1;
		$warningMsg+=$obj+",";
		}
	}
if ($showWarning)
	warning $warningMsg;
}

global proc asMirrorOptions (string $uiName)
{
if (`window -q -ex asMirrorOptions`)
	deleteUI asMirrorOptions;
window -t "Mirror Options" asMirrorOptions;
columnLayout -adj 1;
	separator -h 25 -st "none";
	rowLayout -nc 4 -cw 1 40;
		text -l "side:";
		radioCollection asMOSideRadioCollection;
		radioButton -label "Swap" asMOSideFlip;
		radioButton -label "Right To Left" asMOSideR2L;
		radioButton -label "Left To Right" asMOSideL2R;
		setParent..;
	rowLayout -nc 4 -cw 1 40;
		text -l "axis:";
		radioCollection asMOAxisRadioCollection;
		radioButton -label "X" asMOAxisX;
		radioButton -label "Y" asMOAxisY;
		radioButton -label "Z" asMOAxisZ;
		radioCollection -e -sl "asMOAxisX" asMOAxisRadioCollection;
		setParent..;
	rowLayout -nc 4 -cw 1 40;
		text -l "space:";
		radioCollection asMOSpaceRadioCollection;
		radioButton -label "World" asMOSpaceWorld;
		radioButton -label "MASTER" asMOSpaceMain;
		radioButton -label "RootX_M" asMOSpaceCenter;
		radioCollection -e -sl "asMOSpaceWorld" asMOSpaceRadioCollection;
		setParent..;
	rowLayout -nc 4 -cw 1 40;
		text -l "control:";
		radioCollection asMOSelOnlyRadioCollection;
		radioButton -label "All" asMOSelOnlyAll;
		radioButton -label "Selected" asMOSelOnlySel;
		radioCollection -e -sl "asMOSelOnlyAll" asMOSelOnlyRadioCollection;
		setParent..;

separator -st "none" -h 25;
button -w 100 -l "Mirror" -c ("asMirror "+$uiName);
showWindow;

string $optionVars[]={"asMOSide","asMOSpace","asMOAxis","asMOSelOnly"};
string $cia[];
string $radioCollection,$selected,$optionVarString;
for ($i=0;$i<size($optionVars);$i++)
	{
	$radioCollection=$optionVars[$i]+"RadioCollection";
	$cia=`radioCollection -q -cia $radioCollection`;
	$selected=$cia[0];
	if (`optionVar -ex $optionVars[$i]`)
		{
		$optionVarString=`optionVar -q $optionVars[$i]`;
		for ($y=0;$y<size($cia);$y++)
			if (`gmatch $cia[$y] ("*"+$optionVarString)`)
				$selected=`optionVar -q $optionVars[$i]`;
		}
	radioCollection -e -sl $selected $radioCollection;
	}
}

global proc asMirror (string $uiName)
{
//if (!`window -q -ex $uiName`)
//	error ("Window : "+$uiName+" not found !");
string $side="asMOSideR2L";
string $space="asMOSpaceMain";
string $axis="asMOAxisX";
string $selOnly="asMOSelOnlyAll";
if (`window -q -ex asMirrorOptions`)
	{
	$side=`radioCollection -q -sl asMOSideRadioCollection`;
	$space=`radioCollection -q -sl asMOSpaceRadioCollection`;
	$axis=`radioCollection -q -sl asMOAxisRadioCollection`;
	$selOnly=`radioCollection -q -sl asMOSelOnlyRadioCollection`;
	optionVar -sv asMOSide $side;
	optionVar -sv asMOSpace $space;
	optionVar -sv asMOAxis $axis;
	optionVar -sv asMOSelOnly $selOnly;
	}
if (`optionVar -ex asMOSide`)
	$side=`optionVar -q asMOSide`;
if (`optionVar -ex asMOSpace`)
	$space=`optionVar -q asMOSpace`;
if (`optionVar -ex asMOAxis`)
	$axis=`optionVar -q asMOAxis`;
if (`optionVar -ex asMOSelOnly`)
	$selOnly=`optionVar -q asMOSelOnly`;
string $sel[]=`ls -sl`;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
string $controlSets[]=`asGetControlSetsFromUI $uiName`;
string $controls[]=`sets -q $controlSets`;
string $sortedControls[];
if (`stringArrayCount "MASTER" $controls`)
	$sortedControls={"MASTER","RootX_M","RootExtraX_M"};

for ($i=0;$i<size($controls);$i++)
	if (`gmatch $controls[$i] ($nameSpace+"IK*Spine*")`)
		$sortedControls[size($sortedControls)]=$controls[$i];
for ($i=0;$i<size($controls);$i++)
	if (`gmatch $controls[$i] ($nameSpace+"IK*Leg_*")` || `gmatch $controls[$i] ($nameSpace+"IK*Arm_*")` || `gmatch $controls[$i] ($nameSpace+"Pole*")`)
		$sortedControls[size($sortedControls)]=$controls[$i];
for ($i=0;$i<size($controls);$i++)
	if (!`stringArrayCount $controls[$i] $sortedControls`)
		$sortedControls[size($sortedControls)]=$controls[$i];
$controls=$sortedControls;
if ($selOnly=="asMOSelOnlySel")
	$controls=$sel;
string $allKeyableAttrs[],$tempString[];
string $source,$dest,$destAttr,$cmd,$loc1,$loc2;
float $pos[3],$rot[3];
int $wsXform[];
int $flip,$isFaceControl,$wsXformAttr;
string $flipAxis,$t0;
if ($axis=="asMOAxisX")
	{$flipAxis="X";$t0="tx";}
if ($axis=="asMOAxisY")
	{$flipAxis="Y";$t0="ty";}
if ($axis=="asMOAxisZ")
	{$flipAxis="Z";$t0="tz";}

createNode -n flipGroup transform;
if ($space=="asMOSpaceCenter")
	parent flipGroup ($nameSpace+"RootX_M");
if ($space=="asMOSpaceMain")
	parent flipGroup ($nameSpace+"MASTER");
xform -os -t 0 0 0 -ro 0 0 0 flipGroup;
if ($space=="asMOSpaceCenter" || $space=="asMOSpaceMain")
	parent -w flipGroup;
for ($i=0;$i<size($controls);$i++)
	{
	if ($side!="asMOSideFlip")
		if (`gmatch $controls[$i] "*_M"` || `gmatch $controls[$i] "*MASTER"`)
			continue;
	if ($side=="asMOSideR2L")
		{
		if (`gmatch $controls[$i] "*_L"`)
			continue;
		$dest=`substitute "_R" $controls[$i] "_L"`;
		}
	else if ($side=="asMOSideL2R")
		{
		if (`gmatch $controls[$i] "*_R"`)
			continue;
		$dest=`substitute "_L" $controls[$i] "_R"`;
		}
	else if ($side=="asMOSideFlip")
		{
		if (!`gmatch $controls[$i] "*_L"` && !`gmatch $controls[$i] "*_R"` && !`gmatch $controls[$i] "*_M"`)
			continue;
		if (`gmatch $controls[$i] "*FKExtraSpine1_M"`)
			continue;
		if (`gmatch $controls[$i] "*_L"`)
			$dest=`substitute "_L" $controls[$i] "_R"`;
		if (`gmatch $controls[$i] "*_R"`)
			$dest=`substitute "_R" $controls[$i] "_L"`;
		if (`gmatch $controls[$i] "*_M"`)
			$dest=$controls[$i];
		}
	if (!`objExists $dest`)
		continue;
	$isFaceControl=0;
	if (`objExists ($nameSpace+"FaceControlSet")`)
		if (`sets -im ($nameSpace+"FaceControlSet") $controls[$i]`)
			$isFaceControl=1;
	$source=$controls[$i];
	$allKeyableAttrs=`listAttr -k -m -sn $controls[$i]`;
	for ($y=0;$y<size($allKeyableAttrs);$y++)
		{
		$destAttr=$allKeyableAttrs[$y];
		if			(`gmatch $destAttr "*_R*"`) $destAttr=`substitute "_R" $destAttr "_L"`;
		else if (`gmatch $destAttr "*_L*"`) $destAttr=`substitute "_L" $destAttr "_R"`;		
		$flip=1;
		if (`gmatch $controls[$i] ($nameSpace+"FK*_L")` || `gmatch $controls[$i] ($nameSpace+"FK*_R")`
		 || `gmatch $controls[$i] ($nameSpace+"Bend*_L")` || `gmatch $controls[$i] ($nameSpace+"Bend*_R")`)
		 	{
		 	if ($destAttr=="tx" || $destAttr=="ty" || $destAttr=="tz")
		 		$flip=-1;
		 	}
		else
			if ($destAttr=="tz" || $destAttr=="rx" || $destAttr=="ry")
				$flip=-1;
		if ($isFaceControl)
			$flip=1;
		$wsXformAttr=0;
		if (`gmatch $controls[$i] ($nameSpace+"Aim*")` || `gmatch $controls[$i] ($nameSpace+"IK*")` || `gmatch $controls[$i] ($nameSpace+"Pole*")` || `gmatch $controls[$i] ($nameSpace+"RootX_M*")`)
			$wsXform[$i]=1;
		if ($destAttr=="tx" || $destAttr=="ty" || $destAttr=="tz"
			||$destAttr=="rx" || $destAttr=="ry" || $destAttr=="rz")
			if ($wsXform[$i])
				$wsXformAttr=1;
		if (!$wsXformAttr)
			if (`getAttr -se ($dest+"."+$destAttr)`)
				$cmd+="setAttr "+$dest+"."+$destAttr+" "+(`getAttr ($source+"."+$allKeyableAttrs[$y])`*$flip)+";";
		}

	if ($wsXform[$i])
		{
		$tempString=`spaceLocator`;
		$loc1=$tempString[0];
		$tempString=`spaceLocator`;
		$loc2=$tempString[0];
		parent $loc2 $loc1;
		parent $loc1 $source;
		xform -os -t 0 0 0 -ro 0 0 0 $loc1;
		setAttr ($loc1+".rotateOrder") `getAttr ($source+".rotateOrder")`;
		setAttr ($loc2+".rotateOrder") `getAttr ($source+".rotateOrder")`;
		setAttr ("flipGroup.scale"+$flipAxis) 1;
		parent $loc1 flipGroup;
		setAttr ("flipGroup.scale"+$flipAxis) -1;
		setAttr ($loc1+".scaleX") -1;
		$pos=`xform -q -ws -t $loc2`;
		$rot=`xform -q -ws -ro $loc2`;
		$cmd+="xform -ws -t "+$pos[0]+" "+$pos[1]+" "+$pos[2]+" -ro "+$rot[0]+" "+$rot[1]+" "+$rot[2]+" "+$dest+";";
		}

	if (`attributeExists "mirror" $controls[$i]`)
		setAttr ($controls[$i]+".mirror") 0;
	}
delete flipGroup;
if ($cmd!="")
	eval ($cmd);
select $sel;
}

global proc asGoToBuildPose (string $uiName)
{
int $ctrlButton;
if ((`getModifiers`/4) %  2)
	$ctrlButton=1;
string $nameSpace;
string $controlSets[];
if ($uiName=="bodySetup")
	{
	$nameSpace="";
	$controlSets[0]="ControlSet";
	}
else if ($uiName=="faceSetup")
	{
	$nameSpace="";
	$controlSets[0]="FaceControlSet";
	}
else
	{
	$nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
	$controlSets=`asGetControlSetsFromUI $uiName`;
	}
if ($nameSpace==":")
	$nameSpace="";

string $buildPose="buildPose";
if (`gmatch $controlSets[0] "*FaceControlSet"`)
    $buildPose="faceBuildPose";

string $tempString[],$tempString2[],$buffer[];
string $setAttrCmd,$cmd;


$setAttrCmd=`getAttr ($nameSpace+$buildPose+".udAttr")`;
tokenize $setAttrCmd ";" $tempString;
for ($y=0;$y<size($tempString);$y++)
	{
	$cmd=$tempString[$y];
	if ($cmd=="")
		continue;
	if ($nameSpace!="")
		{
		tokenize $cmd $buffer;
		if (`gmatch $cmd "xform*"`)
			$substituteWordNr=size($buffer)-1;
		else
			$substituteWordNr=1;
		$cmd="";
		for ($z=0;$z<size($buffer);$z++)
			{
			if ($z==$substituteWordNr)
				$cmd+=$nameSpace;
			$cmd+=$buffer[$z]+" ";
			}
		}
	if ($ctrlButton)
		if (`gmatch $cmd "*MASTER.*"`)
			continue;
	if (catchQuiet (`eval ($cmd)`)) warning ("Failed: "+$cmd+"\n");
	}

//run
string $run,$fitTopNode,$objAttr;
for ($i=0;$i<size($controlSets);$i++)
	{
	if (`gmatch $controlSets[$i] "*ControlSet"`)
		if (`objExists ($nameSpace+"FitSkeleton")`)
			$fitTopNode=$nameSpace+"FitSkeleton";
	if (`gmatch $controlSets[$i] "*FaceControlSet"`)
		$fitTopNode=($nameSpace+"FaceFitSkeleton");
	}

if (`objExists $fitTopNode`)
	if (`attributeExists "run" $fitTopNode`)
		{
		$run=`getAttr ($fitTopNode+".run")`;
		if ($nameSpace=="")
			catch (`eval ($run)`);
		else
			{
			tokenize $run ";" $tempString;
			for ($i=0;$i<size($tempString);$i++)
				{
				tokenize $tempString[$i] $tempString2;
				$objAttr=`substitute "\"" $tempString2[1] ""`;
				$objAttr=`substitute "\"" $objAttr ""`;
				$cmd=$tempString2[0]+" "+$nameSpace+$objAttr+" "+$tempString2[2]+";";
				catch (`eval ($cmd)`);
				}
			}
		}
}

global proc asPoserupdateGridBlock (string $uiName, int $childNum)
{
string $existingPopUpMenus[]=`control -q -pma ($uiName+"IconTextButton"+$childNum)`;
for ($pop in $existingPopUpMenus)
	deleteUI $pop;

int $anim=`rowColumnLayout -q -ann ($uiName+"RowColumnLayout"+$childNum)`;
string $button=$uiName+"IconTextButton"+$childNum;
string $viewCmd="asPoseView "+$uiName+" "+$childNum;
string $selectCmd="asPoseObjects "+$uiName+" "+$button+"\" select -add\"";
string $keyCmd="asPoseObjects "+$uiName+" "+$button+" setKeyframe";
string $linearKeyCmd="asPoseObjects "+$uiName+" "+$button+" \"setKeyframe -itt linear -ott linear\"";

popupMenu -p ($uiName+"IconTextButton"+$childNum);
	menuItem -l "View" -c $viewCmd;
	if (!$anim)
		{
		menuItem -d 1;
		menuItem -l "Select" -c $selectCmd;
		menuItem -l "Key" -c $keyCmd;
		menuItem -l "LinearKey" -c $linearKeyCmd;
		}
	if ($uiName=="asPoserDefault")
		{
		menuItem -d 1;
		menuItem -l "Label Button" -c ("asPoserRename "+$childNum);
		menuItem -l "Remove Button" -c ("asPoserDeletePose "+$uiName+" "+$childNum);
		menuItem -l "Update icon" -c ("asPoserSnapShoot "+$uiName+" "+$childNum+" "+$anim+" 1 0");
		if ($anim)
			menuItem -l "Update movie" -c ("asPoserSnapShoot "+$uiName+" "+$childNum+" "+$anim+" 0 1");
		}
}

global proc string asPoserResolveNameSpace (string $uiName, string $obj)
{
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
return ($nameSpace+$obj);
}

global proc asDynRemove (string $uiName)
{
string $sel[]=`ls -sl`;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
if (!size($sel))
	error ("nothing selected");
for ($i=0;$i<size($sel);$i++)
	if (!`gmatch $sel[$i] ($nameSpace+"FK*")`)
		error ($sel[$i]+" is not a FK control");
for ($i=0;$i<size($sel);$i++)
	{
	string $dynObj="dynamics"+`substitute ($nameSpace+"FK") $sel[$i] ""`;
	if(`objExists $dynObj`)
		{
		delete $dynObj;
		print ("// Dynamics for "+$sel[$i]+" removed\n");
		}
	else
		print ("// No dynamics for "+$sel[$i]+" found\n");
	}
}

global proc asDynAdd (string $uiName)
{
string $sel[]=`ls -sl`;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
if (!size($sel))
	error ("nothing selected");
for ($i=0;$i<size($sel);$i++)
	if (!`gmatch $sel[$i] ($nameSpace+"FK*")`)
		error ($sel[$i]+" is not a FK control");
global string $gSelect;
setToolTo $gSelect;

string $deformJoints[];
for ($i=0;$i<size($sel);$i++)
	{
	$deformJoints[$i]=`substitute ($nameSpace+"FK") $sel[$i] ($nameSpace+"")`;
	if (`objExists ("dynamics"+$deformJoints[$i])`)
		error ("dynamics for "+$deformJoints[$i]+" already exists");
	}
$dynSortedDeformJoints=`asResolveDynJoints $nameSpace $deformJoints`;
//Also add end joint, to get dynamics rotation on last selected FK
string $tempString[]=`listRelatives -c -type joint $dynSortedDeformJoints[size($dynSortedDeformJoints)-1]`;
if ($tempString[0]!="" && size($deformJoints)>1)
	{
	string $tempString2[]=`listConnections ($tempString[0]+".rx")`;
	if ($tempString2[0]=="")
		$dynSortedDeformJoints[size($dynSortedDeformJoints)]=$tempString[0];
	}
asDynAddChain $nameSpace $dynSortedDeformJoints;
}

global proc asDynAddChain (string $nameSpace, string $dynSortedDeformJoints[])
{
string $dynJoints[],$tempString[];
string $name;
for ($i=0;$i<size($dynSortedDeformJoints);$i++)
	{
	select $dynSortedDeformJoints[$i];
	$dynJoints[$i]="dyn"+`substitute $nameSpace $dynSortedDeformJoints[size($dynSortedDeformJoints)-1] ""`+$i;
	joint -n $dynJoints[$i];
	}
string $startJoint=$dynJoints[0];
string $endJoint=$dynJoints[size($dynJoints)-1];

string $dynTopNode="dynamics"+`substitute $nameSpace $dynSortedDeformJoints[size($dynSortedDeformJoints)-1] ""`;
if (!`objExists "Dynamics"`)
	createNode -n Dynamics transform;
createNode -n ($dynJoints[0]+"Offset") transform;
int $foundParentFK;
string $parentFK,$fk;
string $joint=$dynSortedDeformJoints[0];
while($parentFK=="")
	{
	$tempString=`listRelatives -type joint -p $joint`;
	if ($tempString[0]=="")
		$parentFK=$nameSpace+"RootX_M";
	else
		{
		$joint=$tempString[0];
		if ($nameSpace=="")
			$fk="FK"+$joint;
		else
			$fk=`substitute $nameSpace $joint ($nameSpace+"FK")`;
		if (`objExists $fk`)
			$parentFK=$fk;
		}
		
	}
parentConstraint $parentFK ($dynJoints[0]+"Offset");
createNode -n $dynTopNode transform;
parent ($dynJoints[0]+"Offset") $dynTopNode;
parent $dynTopNode Dynamics;
setAttr ($dynTopNode+".overrideEnabled") 1;
setAttr ($dynTopNode+".overrideDisplayType") 2;

for ($i=1;$i<size($dynJoints);$i++)
	parent $dynJoints[$i] $dynJoints[$i-1];
$tempString=`ikHandle -n ("DynIKHandle"+$endJoint) -ns 2 -sol ikSplineSolver -sj $startJoint -ee $endJoint`;
rename $tempString[1] ("DynIKEffector"+$endJoint);
string $ikCurve=`rename $tempString[2] ("DynIKCurve"+$endJoint)`;
parent ("DynIKHandle"+$endJoint) $dynTopNode;

parent $dynJoints[0] ($dynJoints[0]+"Offset");

//remove existing
string $dynNodes[]={("DynParticle"+$endJoint),("DynIKCurveSoft"+$endJoint),("DynParticleArrayMapper"+$endJoint),("DynParticleRamp"+$endJoint)};
for ($node in $dynNodes)
	if (`objExists $node`)
		delete $node;

//$numCv
int $numCv;
$form=`getAttr ($ikCurve+".form")`;
$spans=`getAttr ($ikCurve+".spans")`;
$degrees=`getAttr ($ikCurve+".degree")`;
if ($form==2)
	$numCv=$spans;
else
	$numCv=$spans+$degrees;

//soft
$tempString=`soft -d -g 1 -c ("DynIKCurve"+$endJoint)`;
rename $tempString[0] ("DynParticle"+$endJoint);
$tempString=`listRelatives -p ("DynParticle"+$endJoint)`;
rename $tempString[0] ("DynIKCurveSoft"+$endJoint);
rename ("copyOfDynIKCurve"+$endJoint)  ("copyOfDynIKCurveDeform"+$endJoint);
parent ("DynIKCurveSoft"+$endJoint) ("copyOfDynIKCurveDeform"+$endJoint) $dynTopNode;

//mass
for ($i=0;$i<$numCv;$i++)
	{
	float $massPP=($i+0.00)/$numCv;
	if ($massPP==0)
		$massPP=0.01;
	particle -e -or $i -at mass -fv $massPP ("DynParticle"+$endJoint);
	}

//arrayMapper
$tempString=`arrayMapper -target ("DynParticle"+$endJoint) -destAttr goalPP -inputV mass -type ramp`;
rename $tempString[0] ("DynParticleArrayMapper"+$endJoint);

$tempString=`listConnections -s 1 -d 0 ("DynParticleArrayMapper"+$endJoint+".computeNodeColor")`;
rename $tempString[0] ("DynParticleRamp"+$endJoint);
removeMultiInstance -break true ("DynParticleRamp"+$endJoint+".colorEntryList[1]");
setAttr ("DynParticleRamp"+$endJoint+".colorEntryList[0].position") 0;
setAttr ("DynParticleRamp"+$endJoint+".colorEntryList[2].position") 1;
setAttr ("DynParticleRamp"+$endJoint+".colorEntryList[0].color") -type double3 1 1 1 ;
setAttr ("DynParticleRamp"+$endJoint+".colorEntryList[2].color") -type double3 0 0 0;

int $arrayNr=size($dynSortedDeformJoints)-1;
string $fkEnd;
if ($nameSpace=="")
	$fkEnd="FK"+$dynSortedDeformJoints[$arrayNr];
else
	$fkEnd=`substitute $nameSpace $dynSortedDeformJoints[$arrayNr] ($nameSpace+"FK")`;
//`FK-less` end-joint might have been added
if (!`objExists $fkEnd`)
	{
	if ($nameSpace=="")
		$fkEnd="FK"+$dynSortedDeformJoints[$arrayNr-1];
	else
		$fkEnd=`substitute $nameSpace $dynSortedDeformJoints[$arrayNr-1] ($nameSpace+"FK")`;
	}

if (!`attributeExists blend $fkEnd`)
	addAttr -k 1 -ln blend -at double -min 0 -max 1 -dv 1 $fkEnd;
if (!`attributeExists baseGoal $fkEnd`)
	addAttr -k 1 -ln baseGoal -at double -min 0 -max 1 -dv 1 $fkEnd;
if (!`attributeExists tipGoal $fkEnd`)
	addAttr -k 1 -ln tipGoal -at double -min 0 -max 1 -dv 0.6 $fkEnd;
if (!`attributeExists conserve $fkEnd`)
	addAttr -k 1 -ln conserve -at double -min 0 -max 1 -dv 0.75 $fkEnd;
connectAttr ($fkEnd+".baseGoal") ("DynParticleArrayMapper"+$endJoint+".maxValue");
connectAttr ($fkEnd+".tipGoal") ("DynParticleArrayMapper"+$endJoint+".minValue");
connectAttr ($fkEnd+".conserve") ("DynParticle"+$endJoint+".conserve");

//skinCurve
select -cl;
string $fkx;
for ($i=0;$i<size($dynSortedDeformJoints);$i++)
	{
	if ($nameSpace=="")
		$fkx="FKX"+$dynSortedDeformJoints[$i];
	else
		$fkx=`substitute $nameSpace $dynSortedDeformJoints[$i] ($nameSpace+"FKX")`;
	if (`objExists $fkx`)
		select -add $fkx;
	}
select -add ("copyOfDynIKCurveDeform"+$endJoint);
newSkinCluster "-toSelectedBones -mi 1 -dr 4 -rui false";

//pairBlend
for ($i=0;$i<size($dynSortedDeformJoints);$i++)
	{
	if ($i>0)
		{
		$tempString[0]=`pairBlend -nd $dynSortedDeformJoints[$i] -at tx -at ty -at tz`;
		rename $tempString[0] ("parBlendT"+$dynJoints[$i]);
		connectAttr -f ($dynJoints[$i]+".translate") ("parBlendT"+$dynJoints[$i]+".inTranslate2");
		connectAttr ($fkEnd+".blend") ("parBlendT"+$dynJoints[$i]+".weight");
		}
	$tempString[0]=`pairBlend -nd $dynSortedDeformJoints[$i] -at rx -at ry -at rz`;
	rename $tempString[0] ("parBlendR"+$dynJoints[$i]);
	connectAttr -f ($dynJoints[$i]+".rotate") ("parBlendR"+$dynJoints[$i]+".inRotate2");
	connectAttr ($fkEnd+".blend") ("parBlendR"+$dynJoints[$i]+".weight");
	}

setAttr -l 1 ($startJoint+"Offset.v") 0;
setAttr -l 1 ("DynIKHandle"+$endJoint+".v") 0;
setAttr -l 1 ("copyOfDynIKCurveDeform"+$endJoint+".v") 0;

select $fkEnd;
}

global proc string[] asResolveDynJoints (string $nameSpace, string $joints[])
{
string $dynJoints[];
string $jointLongNames[],$tempStringA[],$tempStringB[];
for ($i=0;$i<size($joints);$i++)
	{
	$tempStringA=`ls -l $joints[$i]`;
	$jointLongNames[$i]=$tempStringA[0];
	}
string $sorted[]=`sort $jointLongNames`;
for ($i=1;$i<size($sorted);$i++)
	{
	$tempStringA=`ls $sorted[$i]`;
	$tempStringB=`ls $sorted[$i-1]`;
	if (!`gmatch $sorted[$i] ($sorted[$i-1]+"*")`)
	error ("\""+$tempStringA[0]+"\" is not a child of \""+$tempStringB[0]+"\", select controls in same hiarchy");
	}

string $dynEndJointLongName=$sorted[size($sorted)-1];
$tempStringA=`ls -sn $dynEndJointLongName`;
$dynJoints[0]=$tempStringA[0];
string $joint=$dynJoints[0];
int $reachedStartJoint,$reachedParentOfStartJoint;
while (!$reachedStartJoint)
	{
	$tempStringA=`listRelatives -p -f -type joint $joint`;
	if (!size($tempStringA))
		break;
	$jointLongName=$tempStringA[0];
	$tempStringA=`ls -sn $tempStringA[0]`;
	$joint=$tempStringA[0];
	if (size($joints)==1)
		{
		//single control selected
		if (!`stringArrayCount $jointLongName $sorted`)
			if (!`gmatch $joint "*Part[0-9]*"`)
				$reachedStartJoint=1;
		}
	else
		{
		//several controls selected
		if ($jointLongName==$sorted[0])
			$reachedStartJoint=1;
		}
	$dynJoints[size($dynJoints)]=$joint;
	}
string $dynJointReverse[];
for ($i=size($dynJoints)-1;$i>-1;$i--)
	$dynJointReverse[size($dynJointReverse)]=$dynJoints[$i];
return $dynJointReverse;
}

global proc asParentAdd (string $uiName, int $extra)
{
string $sel[]=`ls -sl`;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
string $tempString[];
string $child;

if (size($sel)<2) error "Select at least 2 objects";

string $parent=$sel[size($sel)-1];
print ("$parent="+$parent+"\n");
for ($i=0;$i<size($sel)-1;$i++)
	{
	$child=$sel[$i];
	if ($extra)
		{
		$tempString=`listRelatives -p $child`;
		if (`gmatch $tempString[0] "*Extra*"`)
			$child=$tempString[0];
		else
			print ("// No Extra control found for \""+$child+"\".\n");
		}
	$tempString=`parentConstraint -mo $parent $child`;
	parent -w $tempString[0];
	}
}

global proc asAutoSwitchFKIK ()
{
string $sel[]=`ls -sl`;
string $name,$nameSpace,$fkIkCtrl,$side,$ik2fk;
float $curFKIKBlend;
string $tempString[],$tempString2[],$fkIkCtrls[];
print "asAutoSwitchFKIK;\n";
for ($i=0;$i<size($sel);$i++)
	{
    if (`gmatch $sel[$i] "*FKIK*"`)
        {
        $fkIkCtrls[size($fkIkCtrls)]=$sel[$i];
        break;
        }
    $tempString[0]=$sel[$i];
    for ($y=0;$y<99;$y++)
        {
        $tempString=`listRelatives -p $tempString[0]`;
        if ($tempString[0]=="") break;
        $tempString2=`listConnections -s 1 -d 0 ($tempString[0]+".v")`;
        if ($tempString2[0]=="") continue;
        if (`objectType $tempString2[0]`!="condition") continue;
        $tempString2=`listConnections -s 1 -d 0 ($tempString2[0]+".firstTerm")`;
        if ($tempString2[0]=="") continue;
        $fkIkCtrls[size($fkIkCtrls)]=$tempString2[0];
        }
	}
if (size($fkIkCtrls)==0)
    error "First select a control that is part of FK/IK setup";
for ($i=0;$i<size($fkIkCtrls);$i++)
    {
		$nameSpace="";
		$fkIkCtrl="";
		$side="";
		$name=$fkIkCtrls[$i];
		tokenize $fkIkCtrls[$i] ":" $tempString;
		if (size($tempString)>1)
			{
			$nameSpace=":"+$tempString[0];
			$name=$tempString[1];
			}
		tokenize $name "_" $tempString;
		$fkIkCtrl=$tempString[0];
		$side="_"+$tempString[1];
		$curFKIKBlend=`getAttr ($fkIkCtrls[$i]+".FKIKBlend")`;
		if ($curFKIKBlend>0 && $curFKIKBlend<5) setAttr ($fkIkCtrls[$i]+".FKIKBlend") 0;
		if ($curFKIKBlend>5 && $curFKIKBlend<10) setAttr ($fkIkCtrls[$i]+".FKIKBlend") 10;
		if ($curFKIKBlend>5) $ik2fk="IK2FK";
		else $ik2fk="FK2IK";
    asSwitchFKIK $fkIkCtrls[$i] `substitute "FKIK" $fkIkCtrl ""` $side $ik2fk;
    }
}

global proc asAutoSwitchPivot ()
{
string $sel[]=`ls -sl`;
if (size($sel)!=2)
	error "Select 1 target object + 1 control";
string $tempString[];
string $target=$sel[0];
string $control=$sel[1];
string $extraControl;
if (!`gmatch $control "*_*"` && `gmatch $target "*_*"`)//selection order was reversed
	{
	$target=$sel[1];
	$control=$sel[0];
	}
if (`gmatch $control "*Extra*"`)//extraControl was selected
	{
	$tempString=`listRelatives -c -type transform $control`;
	$control=$tempString[0];
	}
$tempString=`listRelatives -p $control`;
$extraControl=$tempString[0];
if (!`objExists $extraControl`)
	error ("parent of \""+$control+"\" is not a valid ExtraControl");
float $pos[]=`xform -q -ws -t $control`;
float $rot[]=`xform -q -ws -ro $control`;
float $extraPos[]=`xform -q -ws -t $extraControl`;
float $extraRot[]=`xform -q -ws -ro $extraControl`;
float $targetPos[]=`xform -q -ws -t $target`;
float $targetRot[]=`xform -q -ws -ro $target`;

print "asAutoSwitchPivot;\n";

int $autoKey=`autoKeyframe -q -st`;
if ($autoKey)
	autoKeyframe -st 0;
currentTime (`currentTime -q` -1);
setKeyframe ($extraControl+".t") ($extraControl+".r") ($control+".t") ($control+".r");

currentTime (`currentTime -q` +1);
xform -ws -t $targetPos[0] $targetPos[1] $targetPos[2] -ro $targetRot[0] $targetRot[1] $targetRot[2] $extraControl;
xform -ws -t $pos[0] $pos[1] $pos[2] -ro $rot[0] $rot[1] $rot[2] $control;
setKeyframe ($extraControl+".t") ($extraControl+".r") ($control+".t") ($control+".r");

if ($autoKey)
	autoKeyframe -st 1;

select $extraControl;
print ("// \""+$extraControl+"\" aligned to \""+$target+"\".\n");
}

global proc asAnimBake (string $uiName)
{
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
string $tempString[]=`ls -type transform ($nameSpace+"FKIK*")`;
string $FkIks[];
for ($i=0;$i<size($tempString);$i++)
	if (`attributeExists FKIKBlend $tempString[$i]`)
		if (!`gmatch $tempString[$i] "FKIKSp*ine*"`)
			$FkIks[size($FkIks)]=`substitute ($nameSpace+"FKIK") $tempString[$i] ""`;

if (`window -q -ex asAnimBake`)
    deleteUI asAnimBake;
window -t Bake asAnimBake;
formLayout asAnimBakeFormLayout;
columnLayout;
text -l "Bake:";
optionMenu asAnimBakeOptionMenu;
	menuItem -l "AnimationControls to BakeSkeleton";
	menuItem -l "MotionCapture to FKControls";
	menuItem -l "ExtraControls to Controls";
	for ($i=0;$i<size($FkIks);$i++)
		menuItem -l ("FK to IK : "+$FkIks[$i]);
	for ($i=0;$i<size($FkIks);$i++)
		menuItem -l ("IK to FK : "+$FkIks[$i]);

separator -h 10;
setParent..;
button -l "Ok, Bake" -c ("asAnimBakeGo "+$uiName) asAnimBakeOkButton;

formLayout -e
	-af asAnimBakeOkButton "bottom" 0
	-af asAnimBakeOkButton "left" 0
	-af asAnimBakeOkButton "right" 0
	asAnimBakeFormLayout;

showWindow;
}

global proc asAnimBakeGo (string $uiName)
{
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
string $bake=`optionMenu -q -v asAnimBakeOptionMenu`;
string $limb;

if ($bake=="AnimationControls to BakeSkeleton")
	asAnimBakeSkeleton $uiName;
if ($bake=="MotionCapture to FKControls")
	asAnimBakeMoCapToFk $uiName;
if ($bake=="ExtraControls to Controls")
	asAnimBakeExtra $uiName;
if (`gmatch $bake "FK to IK : *"`)
	{
	$limb=`substitute "FK to IK : " $bake ""`;
	asAnimBakeFKIK $limb 1 $uiName;
	}
if (`gmatch $bake "IK to FK : *"`)
	{
	$limb=`substitute "IK to FK : " $bake ""`;
	asAnimBakeFKIK $limb 0 $uiName;
	}
}

global proc asAnimBakeExtra (string $uiName)
{
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
float $curTime=`currentTime -q`;

string $controlSets[]=`asGetControlSetsFromUI $uiName`;
string $controls[]=`sets -q $controlSets`;
string $tempString[],$tempString2[],$tempString3[],$extraControls[],$bakeControls[],$animCurves[];
for ($i=0;$i<size($controls);$i++)
	if (`gmatch $controls[$i] ($nameSpace+"FKExtra*")` || `gmatch $controls[$i] ($nameSpace+"RootExtraX*")`)
		$extraControls[size($extraControls)]=$controls[$i];

for ($i=0;$i<size($extraControls);$i++)
	{
	$controls[$i]=`substitute "Extra" $extraControls[$i] ""`;
	$bakeControls[$i]=$extraControls[$i]+"BAKER";
	$tempString=`listRelatives -p $extraControls[$i]`;
	createNode -n $bakeControls[$i] -p $tempString[0] transform;
	setAttr ($bakeControls[$i]+".rotateOrder") `getAttr ($controls[$i]+".rotateOrder")`;
	$tempString=`listRelatives -c -type transform $extraControls[$i]`;
	parentConstraint $tempString[0] $bakeControls[$i];
	scaleConstraint $tempString[0] $bakeControls[$i];
	}

//Bake
bakeResults -simulation true -t (`playbackOptions -q -min`+":"+`playbackOptions -q -max`) -sampleBy 1 -disableImplicitControl true -preserveOutsideKeys false -sparseAnimCurveBake false -removeBakedAttributeFromLayer false 
	-bakeOnOverrideLayer false -controlPoints false -shape false $bakeControls;
currentTime $curTime;
select $bakeControls;
evalEcho "delete -staticChannels -unitlessAnimationCurves false -hierarchy none -controlPoints 0 -shape 1";

//remove existing animation
for ($i=0;$i<size($extraControls);$i++)
	{
	$animCurves=`listConnections -s 1 -d 0 -type animCurve $extraControls[$i]`;
	if (size($animCurves)) delete $animCurves;
	xform -os -t 0 0 0 -ro 0 0 0 -s 1 1 1 $extraControls[$i];
	$animCurves=`listConnections -s 1 -d 0 -type animCurve $controls[$i]`;
	if (size($animCurves)) delete $animCurves;
	xform -os -t 0 0 0 -ro 0 0 0 -s 1 1 1 $controls[$i];
	}
//asGoToBuildPose bodySetup;

//Use baked animCurves
for ($i=0;$i<size($extraControls);$i++)
	{
	$animCurves=`listConnections -s 1 -d 0 -type animCurve $bakeControls[$i]`;
	for ($y=0;$y<size($animCurves);$y++)
		{
		$tempString=`listConnections -s 0 -d 1 -p 1 -c 1 $animCurves[$y]`;
		tokenize $tempString[1] "[.]" $tempString2;
		connectAttr $tempString[0] ($controls[$i]+"."+$tempString2[1]);
		tokenize $tempString[0] "[.]" $tempString3;
		rename $tempString3[0] ($controls[$i]+"_"+$tempString2[1]);
		}
	}
delete $bakeControls;
}

global proc asAnimBakeMoCapToFk (string $uiName)
{
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";

string $controlSets[]=`asGetControlSetsFromUI $uiName`;
string $controls[]=`sets -q $controlSets`;
string $bakeControls[];
for ($i=0;$i<size($controls);$i++)
	if (`gmatch $controls[$i] ($nameSpace+"FKExtra*")` || `gmatch $controls[$i] ($nameSpace+"RootExtraX*")`)
		$bakeControls[size($bakeControls)]=$controls[$i];

//Bake
bakeResults -simulation true -t (`playbackOptions -q -min`+":"+`playbackOptions -q -max`) -sampleBy 1 -disableImplicitControl true -preserveOutsideKeys false -sparseAnimCurveBake false -removeBakedAttributeFromLayer false 
	-bakeOnOverrideLayer false -controlPoints false -shape false $bakeControls;
select $bakeControls;
evalEcho "delete -staticChannels -unitlessAnimationCurves false -hierarchy none -controlPoints 0 -shape 1";

if (`objExists MoCap`)
	delete MoCap;
else
	print ("// \"MoCap\" Skeleton not found, and not deleted, you must manually delete your MoCap skeleton to see the baked animation.\n");
select -cl;
}

global proc asAnimBakeFKIK (string $limb, int $Fk2Ik, string $uiName)
{
global int $asBakeFKIK;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
int $numChar=size($limb);
string $side=`substring $limb ($numChar-1) $numChar`;
string $sideLessLimb=`substring $limb 1 ($numChar-2)`;
float $curTime=`currentTime -q`;
float $start=`playbackOptions -q -min`;
float $end=`playbackOptions -q -max`;
currentTime $start;
if ($Fk2Ik)
	{
	setAttr ($nameSpace+"FKIK"+$limb+".FKIKBlend") 0;
	asSwitchFK2IK `substitute "asSelector" $uiName ""` {("FKIK"+$limb)};
	}
else
	{
	setAttr ($nameSpace+"FKIK"+$limb+".FKIKBlend") 10;
	asSwitchIK2FK `substitute "asSelector" $uiName ""` {("FKIK"+$limb)};
	}
$asBakeFKIK=1;
for ($i=$start;$i<$end+1;$i++)
	{
	currentTime $i;
	if ($Fk2Ik)
		asAlignFKIK `substitute "asSelector" $uiName ""` $sideLessLimb $side FK2IK;
	else
		asAlignFKIK `substitute "asSelector" $uiName ""` $sideLessLimb $side IK2FK;
	}
currentTime $curTime;
$asBakeFKIK=0;
}

global proc asAnimBakeSkeleton (string $uiName)
{
if (`confirmDialog -title "Confirm" -message 
	("Bake character ?\n"
	+"This creates a single joint chain for game engine export\n"
	+"The rig controllers will no longer work")
    -button "Yes" -button "No" -defaultButton "Yes"
    -cancelButton "No" -dismissString "No"`!="Yes")
	return;
string $sel[]=`ls -sl`;
string $tempString[],$tempString2[];
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
string $name=`substitute ":" $nameSpace ""`;
string $bakeNameSpace=$name+"Bake:";
namespace -add ($name+"Bake");
namespace -set ($name+"Bake");
$tempString=`listRelatives -c ($nameSpace+"DeformationSystem")`;
$tempString=`duplicate $tempString[0]`;
string $topBakeJoint=$tempString[0];
parent -w $topBakeJoint;
$tempString=`listRelatives -ad $topBakeJoint`;
for ($i=0;$i<size($tempString);$i++)
	if (`objectType $tempString[$i]`!="joint")
		delete $tempString[$i];
string $allBakeJoints[]=`listRelatives -ad -type joint $topBakeJoint`;
$allBakeJoints[size($allBakeJoints)]=$topBakeJoint;
sets -rm ($nameSpace+"DeformSet") $allBakeJoints;
//Disable Skincluster
string $skinClusters[]=`ls -type skinCluster`;
for ($i=0;$i<size($skinClusters);$i++)
    setAttr ($skinClusters[$i]+".nodeState") 1;
//Constraint bakeSkeleton
string $deformJoints[]=`listRelatives -ad -type joint ($nameSpace+"DeformationSystem")`;
for ($i=0;$i<size($deformJoints);$i++)
    {
		if ($nameSpace=="")
			$bakeDeformJoint=$bakeNameSpace+$deformJoints[$i];
		else
			$bakeDeformJoint=`substitute $nameSpace $deformJoints[$i] $bakeNameSpace`;
    parentConstraint $deformJoints[$i] $bakeDeformJoint;
//    scaleConstraint $deformJoints[$i] $bakeDeformJoint;//caues issues with overall scale
    }
//Bake
bakeResults -simulation true -t (`playbackOptions -q -min`+":"+`playbackOptions -q -max`) -sampleBy 1 -disableImplicitControl true -preserveOutsideKeys false -sparseAnimCurveBake false -removeBakedAttributeFromLayer false 
	-bakeOnOverrideLayer false -controlPoints false -shape false $allBakeJoints;
//Transfer deformation to bake skeleton
for ($i=0;$i<size($deformJoints);$i++)
{
    $tempString=`listConnections -s 0 -d 1 -p 1 -c 1 $deformJoints[$i]`;
    for ($y=0;$y<size($tempString);$y=$y+2)
        {        
        if ($nameSpace=="")
        	$newSource=$bakeNameSpace+$tempString[$y];
				else
	        $newSource=`substitute $nameSpace $tempString[$y] $bakeNameSpace`;
        catch (`connectAttr -f $newSource $tempString[$y+1]`);
        }
}
//Enable Skincluster
for ($i=0;$i<size($skinClusters);$i++)
    setAttr ($skinClusters[$i]+".nodeState") 0;

namespace -set ":";
select $allBakeJoints;
evalEcho "delete -staticChannels -unitlessAnimationCurves false -hierarchy none -controlPoints 0 -shape 1";
select $topBakeJoint;
print ("// Selected joint chain is ready for export, add geometry to selection and export\n");
}

global proc asDynBake (string $uiName)
{
if (`confirmDialog -title "Confirm" -message "Bake all dynamics ?"
    -button "Yes" -button "No" -defaultButton "Yes"
    -cancelButton "No" -dismissString "No"`!="Yes")
	return;
asDynUnBake $uiName;
string $softDynCurves[]=`ls -type nurbsCurve "DynIKCurveSoftdyn*"`;
bakeResults -simulation true -t (`playbackOptions -q -min`+":"+`playbackOptions -q -max`) -sampleBy 1 -disableImplicitControl 0 -preserveOutsideKeys 0 -sparseAnimCurveBake false -controlPoints true -shape false $softDynCurves;
}

global proc asDynUnBake (string $uiName)
{
string $softDynCurves[]=`ls -type nurbsCurve "DynIKCurveSoftdyn*"`;
string $particles;
int $spans,$degrees,$numCv;
for ($i=0;$i<size($softDynCurves);$i++)
	{
	$particles=`substitute "DynIKCurveSoft" $softDynCurves[$i] "DynParticle"`;
	$particles=`substitute "Shape" $particles ""`;
	if (!`isConnected ($particles+".targetGeometry") ($softDynCurves[$i]+".create")`)
		connectAttr ($particles+".targetGeometry") ($softDynCurves[$i]+".create");
	if (size(`listConnections -type animCurve $softDynCurves[$i]`))
		delete `listConnections -type animCurve $softDynCurves[$i]`;
	$spans=`getAttr ($softDynCurves[$i]+".spans")`;
	$degrees=`getAttr ($softDynCurves[$i]+".degree")`;
	$numCv=$spans+$degrees;
	for ($y=0;$y<$numCv;$y++)
		setAttr ($softDynCurves[$i]+".cv["+$y+"]") 0 0 0;
	}
}

global proc asJointsVisibilityToggle (string $uiName)
{
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
if (!`objExists ($nameSpace+"MASTER")`)
	return;
string $joints[]=`listRelatives -type joint -ad ($nameSpace+"MASTER")`;
int $onOff=1;
string $tempString[]=`listRelatives -type joint -c ($nameSpace+"DeformationSystem")`;
if (`objExists $tempString[0]`)
	if (`getAttr ($tempString[0]+".drawStyle")`==0)
		$onOff=0;
int $drawStyle=0;
if (!$onOff)
	$drawStyle=2;
for ($i=0;$i<size($joints);$i++)
	setAttr ($joints[$i]+".drawStyle") $drawStyle;
}

global proc asControlsVisibilityToggle ()
{
int $vis;
string $motionSystems[]=`ls -r 1 MotionSystem FaceMotionSystem`;
for ($i=0;$i<size($motionSystems);$i++)
    {
    if ($i==0)
        $vis=!(`getAttr ($motionSystems[$i]+".v")`);
    setAttr ($motionSystems[$i]+".v") $vis;
    }
}

global proc asSetupControlVisibilityHotKeyDialog ()
{
if (`confirmDialog -title "Confirm Control Visibility HotKey"
	-message ("Add toggle of control-visibility to the \"~\" hotkey.\n"
	+"For easy toggling visibility of controls.\n"
	+"Holding down the \"~\" key (next to the \"number 1\" on the keyboard) to see and select controls.\n"
	+"As you let go, controls will again be hidden.\n"
	+"The idea is to work without the `visual clutter` of the controls.\n"
	+"Tip: Ctrl+\"\~\" will leave the controls visible")
	-button "Confirm" -button "Cancel" -defaultButton "Confirm"
	-cancelButton "Cancel" -dismissString "Cancel"`!="Confirm")
	return;
asSetupControlVisibilityHotKey;
}

global proc asSetupControlVisibilityHotKey ()
{
if (!`runTimeCommand -q -ex advancedSkeletonVisibilitySwitch`)
	{
	nameCommand -ann "advancedSkeletonVisibilitySwitch" -c "advancedSkeletonVisibilitySwitch" advancedSkeletonVisibilitySwitchNameCommand;
	runTimeCommand -annotation "switches the visibility of controls" -category "User"
		-command ("int $vis;\nstring $motionSystems[]=`ls -r 1 MotionSystem FaceMotionSystem`;\nfor ($i=0;$i<size($motionSystems);$i++)\n    {\n    if ($i==0)\n        $vis=!(`getAttr ($motionSystems[$i]+\".v\")`);\n    setAttr ($motionSystems[$i]+\".v\") $vis;\n    }")
		advancedSkeletonVisibilitySwitch;
	}
hotkey -keyShortcut "`"  -name "advancedSkeletonVisibilitySwitchNameCommand" -releaseName "advancedSkeletonVisibilitySwitchNameCommand";
hotkey -keyShortcut "\`" -name "advancedSkeletonVisibilitySwitchNameCommand" -releaseName "advancedSkeletonVisibilitySwitchNameCommand";
hotkey -keyShortcut "`"  -ctrlModifier -name "advancedSkeletonVisibilitySwitchNameCommand";
hotkey -keyShortcut "\`" -ctrlModifier -name "advancedSkeletonVisibilitySwitchNameCommand";
}

global proc asVisualizeGimbalLock (string $uiName)
{
string $sel[]=`ls -sl`;
string $nameSpace=`optionMenu -q -v ($uiName+"OptionMenu")`;
if ($nameSpace==":")
	$nameSpace="";
int $fromSelection;
int $buildGimbal[];
float $scale;
float $bb[];
string $name,$lookForVisConnectionOnObject;
string $tempString[];
string $controlSets[]=`asGetControlSetsFromUI $uiName`;
string $controls[]=`sets -q $controlSets`;

if (`objExists GimbalLockVisualizers`)
	{
	delete GimbalLockVisualizers;
	return;
	}
createNode -n GimbalLockVisualizers transform;
if ($sel[0]!="")
	if (`stringArrayCount $sel[0] $controls`)
		$fromSelection=1;
for ($i=0;$i<size($controls);$i++)
	{
	if ($controls[$i]==$nameSpace+"MASTER")
		continue;
	$tempString=`listRelatives -s $controls[$i]`;
	if ($tempString[0]!="")
		if (`objectType $tempString[0]`=="nurbsCurve")
			{
			if ($fromSelection)
				if (`stringArrayCount $controls[$i] $sel`)
					$buildGimbal[$i]=1;
			if (!$fromSelection)
				$buildGimbal[$i]=1;
			}
	}
for ($i=0;$i<size($controls);$i++)
	{
	if (!$buildGimbal[$i])
		continue;
	$name=$controls[$i];
	createNode -n ($name+"Constraint") -p GimbalLockVisualizers transform;
	createNode -n ($name+"Offset") -p ($name+"Constraint") transform;

	polyCylinder -n ($name+"Cones") -r 0.3 -h 2.5 -sx 10 -sy 2 -sz 1 -ax 0 1 0 -rcp 0 -cuv 3 -ch 0;
	scale -r -p 0 0 0 0 0 0 ($name+"Cones.vtx[10:19]");
	parent ($name+"Cones") ($name+"Offset");
	if (`objExists asGreenSG`)
		sets -e -forceElement asGreenSG ($name+"Cones");

	polyTorus -n ($name+"Torus") -r 1 -sr 0.03 -tw 0 -sx 30 -sy 6 -ax 0 1 0 -cuv 1 -ch 0;
	parent ($name+"Torus") ($name+"Offset");
	if (`objExists asRedSG`)
		sets -e -forceElement asRedSG ($name+"Torus");

	polyCylinder -n ($name+"Arrow") -r 0.06 -h 2 -sx 10 -sy 3 -sz 1 -ax 0 1 0 -rcp 0 -cuv 3 -ch 0;
	rotate -r 0 0 90 ($name+"Arrow.vtx[0:41]");
	move -r 1 0 0 ($name+"Arrow.vtx[0:41]");
	scale -r -p 0 0 0 1 0 0 ($name+"Arrow.vtx[0:9]") ($name+"Arrow.vtx[40]");
	move -r 0.35 0 0 ($name+"Arrow.vtx[10:19]");
	scale -r -p 0 0 0 1 1.75 1.75 ($name+"Arrow.vtx[10:19]");
	move -r 1 0 0 ($name+"Arrow.vtx[20:29]");
	parent ($name+"Arrow") ($name+"Offset");
	if (`objExists asGreen2SG`)
		sets -e -forceElement asGreen2SG ($name+"Arrow");
	orientConstraint $name ($name+"Arrow");

	$tempString=`listRelatives -p $name`;
	parentConstraint $tempString[0] ($name+"Constraint");
	$tempString=`listRelatives -s $name`;
	$bb=`xform -q -bb ($tempString[0]+".cv[0:999]")`;
	$scale=(($bb[3]-$bb[0])+($bb[4]-$bb[1])+($bb[5]-$bb[2]))/5.0;
	setAttr -type float3 ($name+"Offset.s") $scale $scale $scale;
	$lookForVisConnectionOnObject=$name;
	$tempString=`listConnections -p 1 ($lookForVisConnectionOnObject+".v")`;
	for ($y=0;$y<20;$y++)
		{
		if ($tempString[0]!="")
			{
			connectAttr $tempString[0] ($name+"Offset.v");
			break;
			}
		$tempString=`listRelatives -p $lookForVisConnectionOnObject`;
		if ($tempString[0]=="")
			break;
		$lookForVisConnectionOnObject=$tempString[0];
		$tempString=`listConnections -p 1 ($lookForVisConnectionOnObject+".v")`;
		}
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 0 -cd ($name+".rotateOrder") ($name+"Cones.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 1 -cd ($name+".rotateOrder") ($name+"Cones.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 2 -cd ($name+".rotateOrder") ($name+"Cones.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 3 -cd ($name+".rotateOrder") ($name+"Cones.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 4 -cd ($name+".rotateOrder") ($name+"Cones.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 5 -cd ($name+".rotateOrder") ($name+"Cones.rx");

	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 0 -cd ($name+".rotateOrder") ($name+"Cones.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 1 -cd ($name+".rotateOrder") ($name+"Cones.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 2 -cd ($name+".rotateOrder") ($name+"Cones.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 3 -cd ($name+".rotateOrder") ($name+"Cones.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 4 -cd ($name+".rotateOrder") ($name+"Cones.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 5 -cd ($name+".rotateOrder") ($name+"Cones.rz");

	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 0 -cd ($name+".rotateOrder") ($name+"Torus.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 1 -cd ($name+".rotateOrder") ($name+"Torus.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 2 -cd ($name+".rotateOrder") ($name+"Torus.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 3 -cd ($name+".rotateOrder") ($name+"Torus.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 4 -cd ($name+".rotateOrder") ($name+"Torus.rx");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 5 -cd ($name+".rotateOrder") ($name+"Torus.rx");

	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 0 -cd ($name+".rotateOrder") ($name+"Torus.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 1 -cd ($name+".rotateOrder") ($name+"Torus.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 2 -cd ($name+".rotateOrder") ($name+"Torus.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 90 -dv 3 -cd ($name+".rotateOrder") ($name+"Torus.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 4 -cd ($name+".rotateOrder") ($name+"Torus.rz");
	setDrivenKeyframe -itt "linear" -ott "linear" -v 0 -dv 5 -cd ($name+".rotateOrder") ($name+"Torus.rz");
	}
select $sel;
}

global proc int asHaveAnimation (string $node)
{
int $haveAnimation=0;
string $nodeType;
string $tempString[]=`listConnections -s 1 -d 0 $node`;

for ($i=0;$i<size($tempString);$i++)
	{
	$nodeType=`objectType $tempString[$i]`;
	if (`gmatch $nodeType "animCurve*"`)
		{
		$haveAnimation=1;
		break;
		}
	}
return $haveAnimation;
}

global proc string asSelectorScriptLocation ()
{
string $whatIs=`whatIs asSelectorScriptLocation`;
string $fullPath=`substring $whatIs 25 999`;
string $buffer[];
int $numTok=`tokenize $fullPath "/" $buffer`;
if ($numTok<2)
	if (`about -win`)
		$numTok=`tokenize $fullPath "\\" $buffer`;
int $numLetters=size($fullPath);
int $numLettersLastFolder=size($buffer[$numTok-1]);
string $scriptLocation=`substring $fullPath 1 ($numLetters-$numLettersLastFolder)`;
return $scriptLocation;
}
//-- ASTools Procedures Ends Here --//
