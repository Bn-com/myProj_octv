global proc xy_robotcache(){if(`window -exists  xy_robotcacheUI`)	deleteUI xy_robotcacheUI;window    -title "xy_robotcache"        xy_robotcacheUI;columnLayout -columnAttach "both" 5 -rowSpacing 10 -columnWidth 100;;button -label "CREAT"       -c "CreatGeocache";intField  -minValue -0           CreatIF;button -label "IMPORT"       -c "ImportGeocache";intField -minValue 0           ImportIF;   showWindow xy_robotcacheUI;}global proc CreatGeocache(){int $num =`intField -q -v CreatIF`;string $path = `file -q -sceneName`;string $base = basename($path,".mb");string $filenamearray[];$filenamearray = stringToStringArray($base, "_");string $episode = ("episode_"+$filenamearray[1]);string $scene = ("scene_"+$filenamearray[2]);string $cachefiles[] = `ls -type cacheFile`;int $count = 0;for($eache in $cachefiles) {  string $result =`match "robot[0-9]+c" $eache`;  if($result != "" )  $count++; }if($num <$count)error  ("The startnum must > "+$count);string $objnames[] = `ls -sl`;for($k=$num;$k<size($objnames)+$num;$k++){   string $array[];  $array = stringToStringArray($objnames[$k-$num], ":");  int $i =0;  string $namespace = "";  for($i=0;$i<size($array)-1;$i++)   {    $namespace = ($namespace+$array[$i]+":");   }  string $meshes[] = {"Arm_L","Arm_R","Body","Body_sphere","Foot_L","Foot_R","Foot_finger_L_01","Foot_finger_L_02","Foot_finger_R_01","Foot_finger_R_02","Hand_01_L","Hand_01_R","Hand_L","Hand_R","Hand_inch01_L","Hand_inch01_R","Hand_inch02_L","Hand_inch02_R","Hand_index01_L","Hand_index01_R","Hand_index02_L","Hand_index02_R","Hand_index03_L","Hand_index03_R","Hand_medium01_L","Hand_medium01_R","Hand_medium02_L","Hand_medium02_R","Hand_medium03_L","Hand_medium03_R","Head_01","Head_02","Head_sphere_L","Head_sphere_R","MSH_sword","Neck","Pelvis","Shoulder_01_L","Shoulder_01_R","Thigh_L","Thigh_R","_cut_:polySurface216","_cut_:polySurface217","_cut_:polySurface218","_cut_:polySurface219","polySurface146","polySurface148","polySurface149","polySurface152","polySurface154","polySurface155","polySurface159","polySurface162","polySurface164","polySurface166","polySurface167","polySurface170","polySurface172","polySurface173","polySurface177","polySurface180","polySurface184","polySurface202","polySurface203","polySurface204","polySurface205","polySurface206","polySurface207","polySurface208"};  select -cl;  for ($mesh in $meshes)   {    select -add ($namespace+$mesh);   } string $panelsname = `paneLayout -q -pane1 viewPanes`;int $isoOn = `isolateSelect - q -s  $panelsname`;if($isoOn ==1) { enableIsolateSelect $panelsname 1; isolateSelect -s 1 $panelsname;  }else { enableIsolateSelect $panelsname 1; isolateSelect -s 1 $panelsname; }  doCreateGeometryCache 4 { "2", "1", "10", "OneFilePerFrame", "1", ("//serverone/WINX_MOVIE_ULTIMATE/data/"+$episode+"/"+$scene+"/geoCache/robot"+$k+"c"),"0",("robot"+$k+"c"),"0", "add", "0", "1", "1","0","1" } ;}}global proc ImportGeocache(){int $num =`intField -q -v ImportIF`;string $path = `file -q -sceneName`;string $base = basename($path,".mb");string $filenamearray[];$filenamearray = stringToStringArray($base, "_");string $episode = ("episode_"+$filenamearray[1]);string $scene = ("scene_"+$filenamearray[2]);string $cachemeshname[] = `ls -sl`;for($j=$num;$j<size($cachemeshname)+$num;$j++){ //++++++++++++++++++++++++++++++++++++++++++++++++++++//getnamespace//++++++++++++++++++++++++++++++++++++++++++++++++++++  string $array[];  $array = stringToStringArray($cachemeshname[$j-$num], ":");  int $k =0;  string $cachemeshnamespace = "";  for($k=0;$k<size($array)-1;$k++)    {    $cachemeshnamespace = ($cachemeshnamespace+$array[$k]+":");    }//+++++++++++++++++++++++++++++++++++++++++++++++++++//+++++++++++++++++++++++++++++++++++++++++++++++++++string $mintime = `playbackOptions -q -min`;string $maxtime =`playbackOptions -q -max`;string $cachefilename = `createNode cacheFile -n ("robot"+$j+"cache1")`;  setAttr ".cn" -type "string" ("robot"+$j+"c");  setAttr ".cp" -type "string" ("\//serverone/WINX_MOVIE_ULTIMATE/data/"+$episode+"/"+$scene+"/geoCache/robot"+$j+"c");	setAttr ".os" 0;	setAttr ".oe" 0;	setAttr ".ss" $mintime;	setAttr ".se" $maxtime;	setAttr ".sf" 1001;connectAttr ":time1.o" ($cachefilename+".tim");string $channelnames[] =`cacheFile -q -cnm  $cachefilename`;  string $arraych[];  $arraych = stringToStringArray($channelnames[0], ":");  int $k =0;  $channelnamespace = "";  for($k=0;$k<size($arraych)-1;$k++)   {    $channelnamespace = ($channelnamespace+$arraych[$k]+":");   }int $channelsize = size($channelnames);setAttr -s $channelsize ($cachefilename+".ch");for($i = 0;$i<$channelsize;$i++) {setAttr ($cachefilename+".ch["+$i+"]") -type "string" $channelnames[$i];string $origename = `substitute  $channelnamespace $channelnames[$i] "" `;string $switchname = `createNode historySwitch -n ($origename+"swith") `;setAttr ($switchname+".ihi") 0;connectAttr ($cachefilename+".ocd["+$i+"]") ($switchname+".inp[0]");connectAttr ($cachefilename+".ir") ($switchname+".pfc");connectAttr -f ($cachemeshnamespace+$origename+".outMesh") ($switchname+".undeformedGeometry[0]");disconnectAttr ($cachemeshnamespace+$origename+".outMesh") ($switchname+".undeformedGeometry[0]");connectAttr -f ($switchname+".outputGeometry[0]") ($cachemeshnamespace+$origename+".inMesh"); }}}xy_robotcache;