global proc loadSyncFile_jmCST(string $filename,string $fileType){	textFieldButtonGrp -e -text $filename _syncListPath_jmCST;}global proc writeShotReport_jmCST(string $filename,string $fileType){	textFieldButtonGrp -e -text $filename _shotFrameTxtFile_jmCST;}global proc distributeSyncFiles(){	string $sourcePath = `textFieldButtonGrp -q -text  _syncListPath_jmCST`;	string $fileExt = "*.txt";	string $syncFiles[] = `getFileList -filespec ($sourcePath+"/"+$fileExt)`;	if(`size $syncFiles` != 0)	{		for($f in $syncFiles)		{			string $buffer[];			tokenize $f "_." $buffer;			string $targetPath = "Z:/Projects/DOD/Production/Animation/episode_"+$buffer[0]+"/scene_"+$buffer[1]+"/sync/"+$f;			string $sourceFile = $sourcePath+"/"+$f;			sysFile -copy $targetPath $sourceFile;		}	}}proc string printShotFrames(string $fileName){	$fileId = `fopen $fileName "r"`;	string $nextLine = `fgetline $fileId`;	int $lineNum = 1;	string $txt = "";	while($lineNum < 4)	{		$nextLine = `fgetline $fileId`;		$lineNum ++;		if($lineNum == 2)			$txt = $nextLine;		else if ($lineNum == 3)			$txt += $nextLine;	}	fclose $fileId;	return $txt;}proc jm_DOD_printshotFrames(string $txtFile,	string $sourcePath ){	string $fileExt ="*.txt";	string $syncFiles[] = `getFileList -filespec ($sourcePath+"/"+$fileExt)`;	string $txt = "";	for($f in $syncFiles)	{		string $nextLine = printShotFrames($sourcePath+"/"+$f)+"\n";		string $buffer[];		tokenize $nextLine "\n" $buffer;		$txt += $buffer[0] + "\t"+$buffer[1]+"\n";	}	$fileId = `fopen $txtFile "w"`;	fprint $fileId $txt;	fclose $fileId;}proc int spaceCharTest(string $nextLine){	string $cptx = $nextLine;	while($nextLine != ($nextLine = `substitute " " $nextLine ""`))		continue;	int $num = 0;	if($cptx != $nextLine)		$num = 1;	return $num;}global proc jmCheckSyncTxt(string $path){	string $fileExt = slash($path)+"/*.txt";	string $listFiles[] = `getFileList -filespec ($fileExt)`;	if(`size $listFiles` != 0)	{		for($f in $listFiles)		{			string $fileName = $path+"/"+$f;			$fileId = `fopen $fileName "r"`;			string $nextLine = `fgetline $fileId`;			int $lineNum = 1;			int $factor = 0;			while(size($nextLine)>0)			{				$nextLine = `fgetline $fileId`;				$lineNum++;				string $removeLineEnter = `substitute "\n" $nextLine ""`;				if($nextLine == "\n")				{					if($factor == 0)					{						print ($f+" error reports:______________________________________________________________\n");						$factor = 1;					}					print ("第"+$lineNum+"行:"+"回车符被发现\n");									}				else if (`gmatch $nextLine "[J-Z]\n"` || `gmatch $nextLine "[j-z]\n"`)				{					if($factor == 0)					{						print ($f+" error reports:______________________________________________________________\n");						$factor = 1;					}					print ("第"+$lineNum+"行:"+"非法字符"+$nextLine+"被发现\n");						}				else if ($lineNum <4 && startString($nextLine,1) == "[")				{					if($factor == 0)					{						print ($f+" error reports:______________________________________________________________\n");						$factor = 1;											}					print ("第"+$lineNum+"行:"+"文件格式错误"+$nextLine+"被发现\n");					}				else if (spaceCharTest($nextLine))				{					if($factor == 0)					{						print ($f+" error reports:______________________________________________________________\n");						$factor = 1;					}					print ("第"+$lineNum+"行:"+"非法字符空格被发现\n");										}				else if (startString($nextLine,1) == "[" && $nextLine != tolower($nextLine))				{					if($factor == 0)					{						print ($f+" error reports:______________________________________________________________\n");						$factor = 1;					}					print ("第"+$lineNum+"行:"+"非法角色"+$nextLine+"被发现\n");				}				else if ($lineNum > 3 && isValidString($removeLineEnter,"[0-9]") == 0 &&  isValidString($removeLineEnter,"[0-9][0-9]") == 0 && isValidString($removeLineEnter,"[0-9][0-9][0-9]") == 0 && isValidString($removeLineEnter,"[0-9][0-9][0-9][0-9]") == 0 && isValidString($nextLine,"[a-iA-I]\n") == 0 && startString($nextLine,1) != "[" && $nextLine != "")				{					if($factor == 0)					{						print ($f+" error reports:______________________________________________________________\n");						$factor = 1;					}					print ("第"+$lineNum+"行:"+"非法数据"+$nextLine+"被发现\n");					}			}			fclose $fileId;		}	}}global proc CST_saveReport(){	string $sourceFilePrefix = `textFieldButtonGrp -q -text _syncListPath_jmCST`;	string $destinFilePath = `textFieldButtonGrp -q -text _shotFrameTxtFile_jmCST`;	string $buffer[];	int $num = `tokenize $sourceFilePrefix "\\/" $buffer`;	string $reportFileName = $destinFilePath + "/dod_" + $buffer[$num-2] + "_report.txt";	jm_DOD_printshotFrames($reportFileName,$sourceFilePrefix);}global proc string slash(string $path){	string $slash = "";	string $tokens[];	int $h = `tokenize $path "\\/" $tokens`;	string $slash = $tokens[0];	for($i=1;$i<$h;$i++)	{		$slash += ("/"+$tokens[$i]);	}	return $slash;}global proc jmCST_MainWin(){	string $cmd = "fileBrowserDialog -m 4 -fc \"loadSyncFile_jmCST\" -an \"select_folder\"";	string $cmd2 = "fileBrowserDialog -m 4 -fc \"writeShotReport_jmCST\" -an \"select_folder\"";//	string $checkCmd = "jmCheckSyncTxt( " +`textFieldButtonGrp -q -text _syncListPath_jmCST`+")";	if(`window -exists w_JM_CST_win`)		deleteUI w_JM_CST_win;	window -title "Check sync txt files" w_JM_CST_win;	string $form = `formLayout`;			textFieldButtonGrp -label "SyncFilePath" -text "" -buttonLabel "Browse" -cw3 90 240 100 -buttonCommand $cmd  _syncListPath_jmCST;			textFieldButtonGrp -label "ReportTo" -text "" -buttonLabel "Browse" -cw3 90 240 100 -buttonCommand $cmd2  _shotFrameTxtFile_jmCST;			string $checkButton = `button -l "Check" -w 100 -command "getSyncTxtPath_CST()"`;			string $reportButton = `button -l "SaveReport" -w 100 -command "CST_saveReport()"`;			string $distributeButton = `button -l "Distribute" -w 100 -vis true -command "distributeSyncFiles()"`;				setParent ..;	formLayout -edit			-attachForm _syncListPath_jmCST				"top" 5			-attachControl _shotFrameTxtFile_jmCST			"top" 5 _syncListPath_jmCST			-attachControl $checkButton						"top" 5 _shotFrameTxtFile_jmCST			-attachControl $distributeButton					"top" 5 _shotFrameTxtFile_jmCST			-attachControl $reportButton						"top" 5 _shotFrameTxtFile_jmCST			-attachControl $reportButton						"left" 5 $checkButton			-attachControl $distributeButton					"left" 5 $reportButton		$form;	showWindow w_JM_CST_win;}global proc getSyncTxtPath_CST(){	string $path = `textFieldButtonGrp -q -text _syncListPath_jmCST`;	jmCheckSyncTxt($path);}/*proc string encodeNum(int $num){	string $char = "";	if($num < 10)		$char = "00"+$num;	else if ($num >= 10 && $num < 100)		$char = "0"+$num;	else		$char = $num;	return $char;}string $xPath = "Z:/Projects/DOD/Production/Animation/episode_101/scene_";int $s = 1;int $e = 173;for($i=$s;$i<=$e;$i++){	string $path = $xPath+encodeNum($i)+"/sync";	jmCheckSyncTxt($path);}*/