## +
## ===================================================================
## Copyright(C) 2010 - 2012 Basefount Technology (Hong Kong) Limited.
## and/or its licensors.  All rights reserved.
##
## The coded instructions, statements, computer programs, and/or
## related material (collectively the "Data") in these files contain
## unpublished information proprietary to Basefount Technology
## (Hong Kong) Limitd. ("Basefount") and/or its licensors, which is
## protected by Hong Kong copyright law and by international treaties.
##
## The Data is provided for use exclusively by You. You have the right 
## to use, modify, and incorporate this Data into other products for 
## purposes authorized by the Basefount software license agreement, 
## without fee.
##
## The copyright notices in the Software and this entire statement, 
## including the above license grant, this restriction and the 
## following disclaimer, must be included in all copies of the 
## Software, in whole or in part, and all derivative works of 
## the Software, unless such copies or derivative works are solely 
## in the form of machine-executable object code generated by a 
## source language processor.
##
## THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. 
## BASEFOUNT DOES NOT MAKE AND HEREBY DISCLAIMS ANY EXPRESS OR
## IMPLIED WARRANTIES INCLUDING, BUT NOT LIMITED TO, THE WARRANTIES
## OF NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A PARTICULAR 
## PURPOSE, OR ARISING FROM A COURSE OF DEALING, USAGE, OR 
## TRADE PRACTICE. IN NO EVENT WILL BASEFOUNT AND/OR ITS LICENSORS 
## BE LIABLE FOR ANY LOST REVENUES, DATA, OR PROFITS, OR SPECIAL, 
## DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES, EVEN IF BASEFOUNTAIN 
## AND/OR ITS LICENSORS HAS BEEN ADVISED OF THE POSSIBILITY 
## OR PROBABILITY OF SUCH DAMAGES.
##
## ===================================================================
## -

## +
## ===================================================================
##  Module Name: McdAgentViewerGUI
##
##  Description:
##    view the data in the mem of McdAgent
##
## ===================================================================
## -

import maya.cmds as cmds
import maya.mel as mel
from McdGeneral import *

def McdAgentViewerGUI():
    
    winName = "McdAgentViewer"
    if cmds.window(winName, ex = True):
        cmds.deleteUI(winName)
    
    cmds.window(winName, title = "Agent Viewer (AF)",rtf =True,menuBar=True, width=250)
    
    cmds.menu( label='Options')
    cmds.menuItem( label='Refresh contents', c = "McdRefreshAgentViewer()")
    cmds.menuItem( label='Help' )
    cmds.menuItem( divider=True )
    cmds.menuItem( label='Exit', c = "McdExitAgentViewer()" )
    
    form = cmds.formLayout()
    tabs = cmds.tabLayout(innerMarginWidth=5, innerMarginHeight=5)
    cmds.formLayout( form, edit=True, attachForm=((tabs, 'top', 0), (tabs, 'left', 0), \
                                                (tabs, 'bottom', 0), (tabs, 'right', 0)) )
    
    # ready ---------------------------------------------------------#
    needUpdate = False
    agentInfoNode = mel.eval("McdSimpleCommand -exe 5;")
    if agentInfoNode == "_NULL_":
        needUpdate = True
    else:
        nbBone = cmds.getAttr(agentInfoNode + ".nbBone")
        if nbBone == 0:
            needUpdate = True
            
    boneStringSet = []
    feelCollideSet = []
    feelFieldSet = []
    if not needUpdate:
        # we parse the string here!!
        boneStructString = cmds.getAttr(agentInfoNode + ".boneStruct")
        boneStringSetRaw = boneStructString.split("#")
        for i in range(nbBone):
            stri = str(i)
            currentBoneString = boneStringSetRaw[i]
            if cmds.getAttr(agentInfoNode + ".feelCollide[" + stri + "]") == 1:
                currentBoneString += "  (@)"
            if cmds.getAttr(agentInfoNode + ".feelField[" + stri + "]") == 1:
                currentBoneString += "  (*)"
            
            boneStringSet.append(currentBoneString)
            
        if nbBone > 32:
            nbRow = 32
        else:
            nbRow = nbBone
        
    
    #--------------------------  Main GUI  --------------------------#
    child0 = cmds.columnLayout(adj = True)
    
    cmds.columnLayout(adj = True)
    cmds.text(l = "Agent Bone Info List", fn = "smallBoldLabelFont", align = "left", width = 250)
    if needUpdate:
        cmds.text(l = "No found information\nClick and select an agent for updating")
    else:
        cmds.textScrollList(numberOfRows = nbBone, append = boneStringSet, nr = nbRow)
        
    cmds.text(l = "Legend: \n@: collide check\n*: field affect", align = "left", width = 250)
    
    cmds.setParent("..")
    cmds.setParent("..")
    
    
    #------------------------- Cricial Help -------------------------#
    child1 = cmds.columnLayout(adj = True)
    cmds.text(l = "# The data in Agent Viewer comes from agent\nmemory and cannot be seen by other way.\n", align = "left", width = 250)
    cmds.text(l = "# Please use these data to specify channels like\ncollideAt:<boneName>.\n", align = "left", width = 250)
    cmds.text(l = "# Names in outliner are just references, \ndon't use them in channels.\n", align = "left", width = 250)
    cmds.button(l = "Check detailed help", h = 40)
    cmds.setParent( '..' )
    
    #------------------------- table layout -------------------------#
    cmds.tabLayout( tabs, edit=True,tabLabel=((child0, "Agent Viewer"),\
                                            (child1, "Quick Tips")))
    cmds.showWindow(winName)

    
def McdRefreshAgentViewer():
    McdAgentViewerGUI()

def McdExitAgentViewer():
    try:
        cmds.deleteUI("McdAgentViewer")
    except:
        pass



























