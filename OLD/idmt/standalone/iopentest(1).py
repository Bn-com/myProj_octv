# -*- coding: utf-8 -*-

import datetime
import os
import platform
import re
import shutil
import threading
import time
import _winreg

def min2():
    tempFolder = "C:\\tools\\LocalTools\\temp"
    source = "\\\\file-cluster\\GDC\\Resource\\Support\\bin\\iopentest\\iopen2.exe"
    temp = os.path.join(tempFolder, os.path.basename(source))
    if os.path.isfile(temp):
        os.remove(temp)
    os.system("SCHTASKS /Delete /TN \"iopentest\" /F")

def iopentest():
    ru = "sz\\tdadmin"
    rp = "Tools@iDmt"
    if os.path.isfile(r"\\file-cluster\GDC\Resource\Support\idmt.ini"):
        ru = "fs\\tdadmin"
        rp = "Td@Man#ager"
    #tempFolder = os.getenv('TEMP')
    tempFolder = "C:\\tools\\LocalTools\\temp"
    if not os.path.isdir(tempFolder):
        os.makedirs(tempFolder)
    source = "\\\\file-cluster\\GDC\\Resource\\Support\\bin\\iopentest\\iopen2.exe"
    temp = os.path.join(tempFolder, os.path.basename(source))
    if os.path.isfile(temp):
        os.remove(temp)
    shutil.copy(source, temp)
    os.system("SCHTASKS /Create /F /TN \"iopentest\" /TR \"%s\" /RU %s /RP %s /SC ONCE /ST %s" % (temp, ru, rp, (datetime.datetime.now() + datetime.timedelta(minutes=1)).strftime("%H:%M")))
    timer = threading.Timer(120.0, min2)
    timer.start()

if __name__ == "__main__":
    iopentest()